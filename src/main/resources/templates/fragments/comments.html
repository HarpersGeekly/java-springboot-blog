<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>Title</title>
</head>
<body>

<!--th:attr allows me to target this element specifically in show.html's ajax request-->
<div th:attr="data-edit-delete-comment-id=${comment.id}" th:fragment="ajaxComment">
    <div class="row commentVoting">

        <!--if not logged in: upvote and downvote arrows are href's linked to the login page. -->
        <div th:if="${!isLoggedIn}">
            <a th:href="${'/login'}">
                <i class="far fa-thumbs-up upvote"></i>
            </a>
        </div>
        <!--if logged in: upvote and downvote arrows function normally.-->
        <div th:if="${isLoggedIn}">
            <i class="far fa-thumbs-up upvote"></i>
        </div>

        <div>
            <h5>
                <span class="voteCount" th:text="${comment.voteCount}"></span>
            </h5>
        </div>

        <div th:if="${isLoggedIn}">
            <i class="far fa-thumbs-down downvote"></i>
        </div>
        <div th:if="${!isLoggedIn}">
            <a th:href="${'/login'}">
                <i class="far fa-thumbs-down downvote"></i>
            </a>
        </div>

    </div>

    <div class="row">
        <h5 class="postedBy">
            <a th:href="${'/profile/' + comment.user.id}">
                <span th:text="${comment.user.username}"></span>
            </a> |
            <span th:text="${#temporals.format(comment.date,  'h:mm a')}"></span> |
            <span th:text="${#temporals.monthNameShort(comment.date)}"></span>
            <span th:text="${#temporals.day(comment.date)}"></span>,
            <span th:text="${#temporals.year(comment.date)}"></span>
        </h5>

        <h5 th:text="${comment.body}" id="commentBodyText" th:attr="data-commentBody-comment-id=${comment.id}"></h5>

        <!-- =============================== Edit Form ============================-->

        <form
                th:action="@{/posts/{postId}/comment/{commentId}/edit(postId=${post.id},commentId=${comment.id})}"
                method="POST"
                th:object="${comment}"
                class="editedCommentForm" id="editedCommentFormId" th:attr="data-edit-form-comment-id=${comment.id}">

                    <textarea class="form-control editedCommentBodyText" name="body"
                              th:value="${comment.body}"
                              style="width: 900px; height: 150px; resize: none">
                    </textarea>

            <input type="hidden" name="id" th:data-edit-form-comment-id="${comment.id}" th:value="${comment.id}"/>

            <button class="editedCommentSubmitBtn">
                submit
            </button>

            <button class="editedCommentCancelBtn">
                cancel
            </button>
        </form>

    </div>
    <!--================================== REPLY TO A COMMENT ======================-->
    <!--============================================================================-->

    <div th:if="${!isLoggedIn}">
        <a th:href="${'/login'}">
            <i class="fas fa-reply"></i> REPLY
        </a>
    </div>
    <div th:if="${isLoggedIn}">
        <h5 class="showReplyTextArea" sec:authorize="isAuthenticated()" th:attr="data-replyButton-comment-id=${comment.id}">
            <i class="fas fa-reply"></i> REPLY
        </h5>
        <h5 class="showReplyTextAreaCancel">
            <i class="fas fa-times"></i> CANCEL
        </h5>

        <div class="replyTextArea">
            <form th:action="${'/posts/' + post.id + '/comment/' + comment.id}" method="post" th:object="${reply}">
                <div class="form-group">
                    <label for="replyFormBody"></label>
                    <textarea class="form-control" id="replyFormBody" name="body"
                              th:field="*{body}"
                              th:placeholder="Comment..."
                              style="width: 900px; height: 150px; resize: none">
                                </textarea>

                    <div th:if="${#fields.hasErrors('body')}"
                         class="alert alert-danger alert-dismissible"
                         role="alert">
                        <span th:errors="*{body}"/>
                    </div>
                    <input class="form-control" type="hidden" name="id" th:field="*{id}"/>
                    <button class="btn btn-primary">
                        <i class="far fa-comment-alt"></i> Reply
                    </button>

                </div>
            </form>
        </div>
    </div>


    <!--===================================== EDIT A COMMENT ========================-->
    <!--=============================================================================-->
    <div class="editAndDeleteWrapper">
        <div class="row">

            <!-- Edit button is an event trigger. There is no form here. -->
            <div class="commentEdit" sec:authorize="isAuthenticated()"
                 th:if="${comment.isOwnedBy(#authentication.principal.id)}">
                <a class="editCommentBtn" th:attr="data-edit-btn-comment-id=${comment.id}">
                    <i class="far fa-edit"></i> edit
                </a>
            </div>

            <!--==================================== DELETE COMMENT BUTTON AND FORM =======================-->
            <!--===========================================================================================-->

            <div class="commentDelete" sec:authorize="isAuthenticated()">
                <form th:if="${comment.isOwnedBy(#authentication.principal.id)}"
                      th:action="@{/posts/{postId}/comment/{commentId}/delete(postId=${post.id}, commentId=${comment.id})}"
                      method="POST"
                      th:object="${comment}"
                      class="deleteCommentForm">

                    <input type="hidden" name="id" th:attr="data-comment-id=${comment.id}" th:value="${comment.id}"/>
                    <!--<input type="hidden" name="id" id="deleteCommentBtn" th:value="${comment.id}"/>-->
                    <button type="submit" class="deleteCommentBtn">
                        <i class="fas fa-bomb"></i> delete
                    </button>
                    <!--<i class="fas fa-bomb"></i>-->
                    <!--<input type="submit" value="delete" class="deleteCommentBtn"/>-->
                </form>
            </div>

        </div>
    </div>

    <hr class="commentHR"/>
</div>
</body>
</html>