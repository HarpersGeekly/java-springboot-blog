<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="fragments/header :: my-header('Search Results')"></head>
<body>
<nav th:include="fragments/navbar :: my-navbar"></nav>
<div class="indexCategoriesListWrapper">
    <a class="indexEachCategory" th:each="category : ${categories}" th:text="${category.name}" th:href="@{/posts/search(term=${category.name})}"></a>
</div>

<div class="dropdown btn-group">
    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <span>Categories</span><i class="fas fa-caret-down categoriesDropdownDown"></i>
    </button>
    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <li class="navDropdownEachCategory" th:field="*{categories}" th:each="category : ${categories}">
            <a class="navDropdownCategoryLink" th:text="${category.name}" th:href="@{/posts/search(term=${category.name})}"></a>
        </li>
    </ul>
</div>

<a href="#" class="scrollUp"><i class="fas fa-arrow-circle-up indent"></i></a>

<div id="searchResultPageWrapper">

    <div id="emptySearchDiv" th:if="${searchedContent.isEmpty()}">
        <p id="emptySearchedContent"><i class="far fa-frown profileFrownIcon"></i> There are no posts for this category yet. <a th:href="${'/posts/create'}">Get posting!</a></p>
    </div>

    <div th:each="post : ${searchedContent}">

        <div class="searchResultsPagePostWrapper">
                <div class="postPicWrapper">
                    <!--<span th:if="${post.user.profilePicture} == null">-->
                    <!--<img class="profilePicPostIndex" src="/../images/user.png"/>-->
                    <!--</span>-->
                    <!--<span th:if="${post.user.profilePicture} != null">-->
                    <!--<img class="profilePicPostIndex" th:src="@{'/uploads/' + ${post.user.profilePicture}}"/>-->
                    <!--</span>-->
                </div>

                <div class="postInfoWrapper">

                    <div class="indent">
                        <h4 th:text="${post.title}" class="postTitleIndexPage">
                            <!--<a th:href="@{/posts/{id}(id=${post.id})}"></a> -->
                        </h4>

                        <div class="post-tags">
                            <a class="post-tag" th:each="tag : ${post.getCategories()}" th:text="${tag.name}" th:href="@{/posts/search(term=${tag.name})}"></a>
                        </div>

                        <h5>By: <a class="postedByNameTextIndex" th:href="@{/profile/{id}(id=${post.user.id})}">
                            <span th:text="${post.user.username}"></span></a>
                            <span class="postedByDateTime" th:text="${#temporals.format(post.date,  'h:mm a')}"></span>
                            <span class="postedByDate" th:text="${#temporals.monthNameShort(post.date)}"></span>
                            <span class="postedByDate" th:text="${#temporals.day(post.date)}"></span>
                            <span class="postedByDate" th:text="${#temporals.year(post.date)}"></span>
                        </h5>
                        <div>
                            <i class="fas fa-thumbs-up postUpVoteIconIndex"></i>
                            <h5 class="postVoteCountIndex" th:text="${post.voteCount()}"></h5>
                            <i class="fas fa-comments postCommentIconIndex"></i>
                            <h5 class="postCommentSizeIndex" th:text="${post.getComments().size()}"></h5>
                        </div>
                    </div>

                    <!--<div th:each="image : ${post.postImage}">-->
                    <!--<img th:src="${image.path}"/>-->
                    <!--</div>-->

                    <div class="gradientBox">
                        <div class="postDescription hidden">
                            <p th:utext="${post.htmlDescription}"></p>
                        </div>

                        <div class="read-more-div">
                            <i class="fas fa-hand-point-right fa-read-more"></i>
                            <a class="read-more" th:href="@{/posts/{id}(id=${post.id})}">continue reading...</a>
                        </div>
                    </div>
                    <!--<h5 id="createdDate">created: <span th:text="${#temporals.format(post.date, 'MM-dd-yyyy, h:mm a')}"></span></h5>-->
                    <!--</div>-->
                    <!--// wanna use a button to send to edit here? -->
                    <!--<button> <a th:href="@{/posts/{id}/edit(id=${post.id})}"  th:text="${'Edit: ' + post.title}"></a></button>-->
                </div>

        </div>
            <!--<hr class="commentHR"/>-->
    </div>

</div>
<div class="popularityWrapperMobile">

    <h4 class="popularityHeader">Popular Posts</h4>
    <div class="eachPopularSection">

        <div class="eachPopularPost" th:each="post : ${mostCommentedPosts}">
            <div class="popularPostTitleWrapper">

                <div class="popularPostCountsWrapper">
                    <i class="fas fa-comments popularPostCountIcon"></i>
                    <h5 class="popularPostCount" th:text="${post.getComments().size()}"></h5>
                </div>

                <a class="popularTitleLink" th:href="@{/posts/{id}(id=${post.id})}">
                    <h4 class="popularTitleText" th:text="${post.title}"></h4>
                </a>
            </div>

            <div class="popularPostUserWrapper">
                <a class="popularNamesLink" th:href="@{/profile/{id}(id=${post.user.id})}">
                    <span style="color:darkgray">by: </span><span th:text="${post.user.username}"></span>
                </a>
            </div>
        </div>
    </div>


    <h4 class="popularityHeader">Top Rated Posts</h4>
    <div class="eachPopularSection">

        <div class="eachPopularPost" th:each="post : ${mostLikedPosts}">
            <div class="popularPostTitleWrapper">

                <div class="popularPostCountsWrapper">
                    <i class="fas fa-thumbs-up popularPostCountIcon"></i>
                    <h5 class="popularPostCount" th:text="${post.voteCount()}"></h5>
                </div>

                <a class="popularTitleLink" th:href="@{/posts/{id}(id=${post.id})}">
                    <h4 class="popularTitleText" th:text="${post.title}"></h4>
                </a>
            </div>

            <div class="popularPostUserWrapper">
                <a class="popularNamesLink" th:href="@{/profile/{id}(id=${post.user.id})}">
                    <span style="color:darkgray">by: </span><span th:text="${post.user.username}"></span>
                </a>
            </div>
        </div>

    </div>

    <h4 class="popularityHeader">Top Rated Users</h4>
    <div class="eachPopularSection">
        <div class="popularUsers">

            <div class="popularKarmas">
                <div th:each="karma : ${karmas}">
                    <i class="fas fa-hand-peace karma-icon-index-page"></i>
                    <span th:text="${karma}"></span>
                </div>
            </div>

            <div class="popularNames">
                <div th:each="user : ${popularUsers}">
                    <a class="popularNamesLink" th:href="@{/profile/{id}(id=${user.id})}">
                        <span th:text="${user.username}"></span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<footer th:include="fragments/footer :: my-footer"></footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>

    $(function() {

            //if I want to make borders on the posts, don't show one for the last post
            $(".content").last().css("border", "none");

            // ============================ IMAGE RESIZER ================================================

            $('.postDescription img').each(function () {
                // if ($(this).find('img').length) {
                // there is an image in this div, do something...
                let maxWidth = 740;
                let ratio = 0;
                let img = $(this);

                if (img.width() > maxWidth) {
                    ratio = img.height() / img.width();
                    img.css("height", (maxWidth * ratio));
                    img.css("width", maxWidth);
                    // To prevent the DOM bouncing around during resizing, hide it first.
                    // Add a "hidden" (display:none in css) class to the html element $() then remove it after resizing is complete
                    $('.postDescription').removeClass('hidden');
                    // img.attr("height", (maxWidth * ratio));
                    // img.attr("width", maxWidth);
                }
                // }
                $('.postDescription').removeClass('hidden');
            });

            // ============================= RETURN TO TOP ON CLICK =======================================

            $(window).scroll(function () {
                if ($(this).scrollTop() > 500) {
                    $('.scrollUp').fadeIn("slow");
                } else {
                    $('.scrollUp').fadeOut();
                }
            });
            $('.scrollUp').click(function () {
                $("html, body").animate({
                    scrollTop: 0
                }, 500);
                return false;
            });
        })

</script>
</body>
</html>