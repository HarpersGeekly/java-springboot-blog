<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:include="fragments/header :: my-header('Harper\'s Geekly - Show Post')"></head>
<body>
<nav th:include="fragments/navbar :: my-navbar"></nav>

<a href="#" class="scrollUp"><i class="fas fa-arrow-circle-up"></i></a>

<div class="showPageWrapper">
    <!-- ================================================================================================================-->
    <!-- ====================================================  SHOW THE POST ============================================-->
    <!-- ================================================================================================================-->
        <div class="postWrapper-showPage">

            <div class="postInfoWrapper" id="custom-content-width">
                <div class="indent">
                    <!-- BEFORE allowing markdown editing for titles:-->
                    <!--<h4 th:text="${post.title}" class="postTitle no-text-decoration">-->
                    <!--AFTER allowing markdown editing for titles. Uses new property in Post class and th:utext-->
                    <!--<h4 th:utext="${post.htmlTitle}" class="postTitle no-text-decoration"></h4>-->
                    <!-- OR call the method directly:-->
                    <h4 th:utext="${post.getHtmlTitle()}" class="postTitle no-text-decoration"></h4>

                    <div class="post-tags-div">
                        <a class="post-tag" th:each="tag : ${post.getCategories()}" th:text="${tag.name}" th:href="@{/posts/search(term=${tag.name})}"></a>
                    </div>

                    <div class="post-info-wrapper-mobile">
                        <a th:href="@{/profile/{id}(id=${post.user.id})}">
                            <div class="profile-pic-wrapper-show-page">
                                <span th:if="${post.user.profilePicture} == null">
                                    <img class="profile-pic-show-page profile-pic-show-page-mobile" src="/../images/user.png"/>
                                </span>
                                <span th:if="${post.user.profilePicture} != null">
                                    <img class="profile-pic-show-page profile-pic-show-page-mobile" th:src="@{'/uploads/' + ${post.user.profilePicture}}"/>
                                </span>
                            </div>
                        </a>

                        <div class="post-info-name-date-wrapper">
                            <div>By: <a class="postedByNameTextIndex" th:href="@{/profile/{id}(id=${post.user.id})}">
                                <span th:text="${post.user.username}"></span></a>
                                <div>
                                    <span class="postedByDateTime" th:text="${#temporals.format(post.date,  'h:mm a')}"></span>
                                    <span class="postedByDate" th:text="${#temporals.monthNameShort(post.date)}"></span>
                                    <span class="postedByDate" th:text="${#temporals.day(post.date)}"></span>
                                    <span class="postedByDate" th:text="${#temporals.year(post.date)}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ====================================== Post Description =================================-->

                <div class="postDescription hidden show-all-content">
                    <p th:utext="${post.htmlDescription}"></p> <!--th:utext for markdown editor, not th:text-->
                </div>

                <!-- ====================================== Post Voting ======================================-->
                <div class="post-vote-options-row">

                    <div class="postVoting">
                        <div class="upvoteDiv">

                            <div th:if="${!isLoggedIn}">
                                <i class="fas fa-thumbs-up commentVoteNotLoggedIn"></i>
                            </div>

                            <div th:if="${isLoggedIn}" >
                                <form th:action="@{/posts/upvote/{postId}(postId=${post.id})}" method='POST'
                                      th:attr="data-upvote-post-id=${post.id}">
                                    <i th:classappend="${upvote} ? stayActive : postUpvote"
                                       class="fas fa-thumbs-up postUpvote" th:if="${isLoggedIn}"></i>
                                    <!--when clicked, stayActive class will be added or removed.-->
                                </form>
                            </div>
                        </div>

                        <div class="voteCountDiv">
                            <h5>
                                <span class="postVoteCount" th:text="${post.voteCount()}" th:attr="data-voteCount-post-id=${post.id}"></span>
                            </h5>
                        </div>

                        <div class="downvoteDiv">

                            <div th:if="${isLoggedIn}">
                                <form th:action="@{/posts/downvote/{postId}(postId=${post.id})}" method='POST'
                                      th:attr="data-downvote-post-id=${post.id}">
                                    <i th:classappend="${downvote} ? stayActive : postDownvote"
                                       class="fas fa-thumbs-down postDownvote" th:if="${isLoggedIn}"></i>
                                </form>
                            </div>

                            <div th:if="${!isLoggedIn}">
                                <i class="fas fa-thumbs-down commentVoteNotLoggedIn"></i>
                            </div>

                        </div>
                    </div>

                    <!-- ====================================== Post Edit and Delete Buttons =====================-->

                    <div th:if="${isPostOwner}">
                        <i class="fas fa-ellipsis-h fa-lg comment-ellipsis dropdown-toggle"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        </i>
                        <div class="dropdown-menu edit-delete-dropdown" aria-labelledby="dropdownMenu">
                            <div>
                                <a class="dropdown-edit-btn"  th:href="${'/posts/' + post.id + '/edit'}">
                                    <i class="far fa-edit"></i> edit
                                </a>
                            </div>
                            <div>
                                <form th:action="@{'/posts/' + ${post.id} + '/delete'}" method="post" class="deleteCommentForm">
                                    <button class="dropdown-delete-btn" type="submit">
                                        <i class="fas fa-bomb"></i> delete
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!--id="editPostBtn"-->
                    <!--id="deletePostBtn"-->
                </div>

                <div th:if="${!isLoggedIn}" class="replyPostNotLoggedInWrapper">
                    <div class="replyPostNotLoggedInDiv">
                        <h5>You must be <span><a class="replyPostNotLoggedInLink" th:href="${'/login'}">logged in</a></span> to join the conversation</h5>
                    </div>
                </div>

            </div>

        </div>

        <!-- ================================================================================================================-->
        <!--============================================== FORM for COMMENTS ================================================-->
        <!-- ================================================================================================================-->

        <div class="container commentFormWrapper" sec:authorize="isAuthenticated()">
                <form th:action="${'/posts/' + post.id}" method="post" th:object="${comment}" class="commentForm">
                    <div class="form-group">
                        <label for="commentFormBody"></label>
                        <textarea class="form-control" id="commentFormBody" name="body"
                                  th:field="*{body}"
                                  th:placeholder="Comment...">
                                </textarea>

                        <div class="commentsErrorAJAX"></div>
                        <!-- ======================== submit comment ================================-->

                        <input class="form-control" type="hidden" id="postId" th:value="${post.id}"/>
                        <button class="btn btn-primary commentSubmitBtn">
                            <i class="far fa-comment-alt"></i> Comment
                        </button>
                    </div>
                </form>

        </div>
    <!-- ================================================================================================================-->
    <!--============================================= SHOW ALL COMMENTS (PAGEABLE) ======================================-->
    <!-- ================================================================================================================-->

    <hr id="commentHRLeader"/>

    <div class="container commentSection commentsAJAX"></div>
    <!-- This div will prepend with new ajax html. It should not be targeted otherwise -->

    <div class="container commentSection" th:each="comment : ${comments}" th:data="*{comment}">
        <!--// PAGINATION-->
        <!--<div class="container commentSection" th:each="comment : ${page}" th:data="*{page}">-->
        <!--PAGINATION \\-->

        <!--th:attr allows me to target this element specifically in show.html's ajax request-->
        <div class="commentWrapper" th:attr="data-edit-delete-comment-id=${comment.id}">
            <!-- this div should be targeted with unique th:attr -->
            <a th:href="@{/profile/{id}(id=${comment.user.id})}">
                <div class="commentPicWrapper">
                    <span th:if="${comment.user.profilePicture} == null">
                        <img class="profilePicComment" src="/../images/user.png"/>
                    </span>
                    <span th:if="${comment.user.profilePicture} != null">
                        <img class="profilePicComment" th:src="@{'/uploads/' + ${comment.user.profilePicture}}"/>
                    </span>
                </div>
            </a>

            <div class="commentInfoWrapper">

                    <h5 th:classappend="${isChildComment != null} ? parentCommentStyling : commentedByStyling">
                        <a th:href="${'/profile/' + comment.user.id}" style="text-decoration: none;">
                            <span class="commentedByNameText" th:text="${comment.user.username}"></span>
                        </a>
                        <span class="comment-info-date-wrapper">
                            <span class="commentedByDateTime" th:text="${#temporals.format(comment.date,  'h:mm a')}"
                                  style="margin-right: 0.75em;"></span>
                            <span class="commentedByDate" th:text="${#temporals.monthNameShort(comment.date)}"></span>
                            <span class="commentedByDate" th:text="${#temporals.day(comment.date)}">,</span>
                            <span class="commentedByDate" th:text="${#temporals.year(comment.date)}"></span>
                        </span>

                        <span class="comment-info-date-mobile-wrapper">
                            <div class="comment-info-mobile">
                                <span class="commentedByDateTime" th:text="${#temporals.format(comment.date,  'h:mm a')}"
                                      style="margin-right: 0.75em;"></span>
                                <span class="commentedByDate" th:text="${#temporals.monthNameShort(comment.date)}"></span>
                                <span class="commentedByDate" th:text="${#temporals.day(comment.date)}">,</span>
                                <span class="commentedByDate" th:text="${#temporals.year(comment.date)}"></span>
                            </div>
                        </span>
                    </h5>


                <!-- =============================== Comment Body =========================-->

                <div class="commentBodyWrapper">

                    <!--uncomment if I want to have @Poster for the parent comments, but thinking maybe not necessary-->
                    <!--<a th:if="${isChildComment != null}" th:href="${'/profile/' + post.user.id}" th:text="${'@' + post.user.username}"></a>-->

                    <h5 th:text="${comment.body}" class="commentBodyText"
                        th:attr="data-comment-body-comment-id=${comment.id}">
                    </h5>
                </div>

                <!-- =============================== Edit Form ============================-->

                <div class="editedCommentFormWrapper">
                    <form
                            th:action="@{/posts/{postId}/comment/{commentId}/edit(postId=${post.id},commentId=${comment.id})}"
                            method="POST"
                            th:object="${comment}"
                            class="editedCommentForm hidden" id="editedCommentFormId"
                            th:attr="data-edit-form-comment-id=${comment.id}">

                        <textarea class="form-control editedCommentBodyText" name="body"
                                  th:attr="data-edit-comment-form-textarea-comment-id=${comment.id}"
                                  th:value="${comment.body}">
                        </textarea>

                        <input type="hidden" name="id" th:value="${comment.id}"/>

                        <div class="editAndDeleteBtnsRow">

                            <button class="btn btn-primary editedCommentCancelBtn">
                                CANCEL
                            </button>

                            <button class="btn btn-primary editedCommentSubmitBtn">
                                SAVE
                            </button>

                        </div>
                    </form>
                </div>

                <!-- =============================== Comment Votes =========================-->

                <div class="comment-vote-reply-options-row">
                    <div class="commentVoting" th:attr="data-commentVoting-comment-id=${comment.id}">

                        <div class="upvoteDiv">

                            <div th:if="${!isLoggedIn}">
                                <i class="fas fa-thumbs-up commentVoteNotLoggedIn"></i>
                            </div>

                            <div th:if="${isLoggedIn}" >
                                <form th:action="@{/comment/upvote/{commentId}(commentId=${comment.id})}" method="POST"
                                      th:attr="data-upvote-comment-id=${comment.id}">
                                    <i th:classappend="${comment.getVoteFrom(#authentication.principal) != null &amp;&amp; comment.getVoteFrom(#authentication.principal).isUpvote()} ? stayActive : commentUpvote"
                                       class="fas fa-thumbs-up commentUpvote"
                                       th:if="${isLoggedIn}" th:attr="data-upvoteIcon-comment-id=${comment.id}"></i>
                                </form>
                            </div>
                        </div>

                        <div class="voteCountDiv">
                            <h5>
                                <span class="commentVoteCount" th:text="${comment.voteCount()}"
                                      th:attr="data-voteCount-comment-id=${comment.id}"></span>
                            </h5>
                        </div>

                        <div class="downvoteDiv">
                            <div th:if="${isLoggedIn}">
                                <form th:action="@{/comment/downvote/{commentId}(commentId=${comment.id})}" method="POST"
                                      th:attr="data-downvote-comment-id=${comment.id}">
                                    <i th:classappend="${comment.getVoteFrom(#authentication.principal) != null &amp;&amp; comment.getVoteFrom(#authentication.principal).isDownvote()} ? stayActive : commentDownvote"
                                       class="fas fa-thumbs-down commentDownvote"
                                       th:if="${isLoggedIn}" th:attr="data-downvoteIcon-comment-id=${comment.id}"></i>
                                </form>
                            </div>

                            <div th:if="${!isLoggedIn}">
                                <i class="fas fa-thumbs-down commentVoteNotLoggedIn"></i>
                            </div>

                        </div>
                    </div>

                    <!--================================== REPLY TO A COMMENT ===========================================-->
                    <!--=================================================================================================-->

                    <h5 th:if="${!isLoggedIn}" class="replyCommentNotLoggedInDiv"><span><a class="replyCommentNotLoggedInLink" th:href="${'/login'}">LOGIN</a></span></h5>

                    <div th:if="${isLoggedIn}">

                        <h5 class="showReplyTextArea" th:attr="data-show-reply-textarea-comment-id=${comment.id}">
                            <!--data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">-->
                            <i class="fas fa-reply flipped-reply"></i> REPLY
                        </h5>
                        <h5 class="showReplyTextAreaCancel hidden" th:attr="data-cancel-reply-textarea-comment-id=${comment.id}">
                            <i class="fas fa-times"></i> CANCEL
                        </h5>

                    </div>

                    <!--==================================== EDIT AND DELETE DROPDOWN ===================================-->
                    <!--=================================================================================================-->

                    <div sec:authorize="isAuthenticated()" th:if="${comment.isOwnedBy(#authentication.principal.id)}" th:attr="data-ellipsis-comment-id=${comment.id}">
                        <i class="fas fa-ellipsis-h fa-lg comment-ellipsis dropdown-toggle"
                               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        </i>
                        <div class="dropdown-menu edit-delete-dropdown" aria-labelledby="dropdownMenu">

                            <div>
                                <a class="dropdown-edit-btn" th:attr="data-edit-btn-comment-id=${comment.id}">
                                    <i class="far fa-edit"></i> edit
                                </a>
                            </div>
                            <div>
                                <form th:action="@{/posts/{postId}/comment/{commentId}/delete(postId=${post.id}, commentId=${comment.id})}"
                                method="POST"
                                th:object="${comment}"
                                class="deleteCommentForm">

                                    <input type="hidden" name="id" th:attr="data-comment-id=${comment.id}" th:value="${comment.id}"/>

                                    <button class="dropdown-delete-btn" th:attr="data-delete-btn-comment-id=${comment.id}">
                                        <i class="fas fa-bomb"></i> delete
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="replyTextArea hidden" th:attr="id=${'replyTextArea_' + comment.id}">
                    <!--th:attr="data-wrapper-reply-textarea-comment-id=${comment.id}"-->

                    <form th:action="@{/posts/{postId}/comment/{commentId}/reply(postId=${post.id},commentId=${comment.id})}"
                          method="post"
                          th:object="${comment}"
                          th:attr="data-reply-form-comment-id=${comment.id}">
                        <div class="form-group">
                            <label for="replyFormBody"></label>

                            <textarea contenteditable="true" class="form-control replyFormBody" id="replyFormBody" name="body"
                                      th:field="*{body}"
                                      th:attr="data-reply-form-body-comment-id=${comment.id}">
                                </textarea>

                            <input class="form-control" type="hidden" name="id" th:field="*{id}"/>
                            <button class="btn btn-primary commentReplyBtn"
                                    th:attr="data-reply-submit-btn-comment-id=${comment.id}">
                                <i class="far fa-comment-alt"></i> Reply
                            </button>
                            <div class="repliesErrorAJAX" th:attr="data-reply-error-comment-id=${comment.id}"></div>
                        </div>
                    </form>
                </div>

            </div><!--end of commentInfoWrapper-->
        </div>

        <!--SHOW CHILD COMMENTS UNDERNEATH PARENT COMMENT:-->
        <div class="eachChildCommentDiv indent-comment" th:each="child : ${comment.getChildrenComments()}">

            <div class="child-comment" th:include="fragments/comments :: ajaxComment(comment=${child})"></div>
        </div>

        <hr class="commentHR"/>

        <!--ALL NEW CHILD COMMENTS COMING IN ARE APPENDED HERE-->
        <div class="childCommentDiv indent-comment" th:attr="data-child-node-comment-id=${comment.id}"></div>

    </div>
</div>

<footer th:include="fragments/footer :: my-footer"></footer>
<script>

    let postWrapper = $('.postWrapper-showPage');
    let container = $('.container');
    $('#srch-term').val('');

    //==================================================================================================================
    //===================================== Click Reply, Text Changes to Cancel, Vice Versa ============================
    //==================================================================================================================
    //click on Reply, text changes to Cancel and opens textarea for reply form:
    container.on("click", ".showReplyTextArea", function () {

        let $this = $(this);
        $this.addClass('hidden');
        $this.siblings('.showReplyTextAreaCancel').removeClass('hidden');
        let commentId = $this.data('show-reply-textarea-comment-id');
        $('#replyTextArea_' + commentId).removeClass('hidden');
        $('.replyFormBody').val('').focus();

        // send an ajax request to retrieve the username of the owner of the post?:
        // $.get( '/posts/retrieveUsername/comment/' + commentId, function(user) {
        //     $('.replyFormBody').val('@' + user.username + '   ');
        // });
    });

    //click on Cancel, text changes to Reply and closes textarea for reply form:
    container.on("click", ".showReplyTextAreaCancel", function () {

        let $this = $(this);
        $this.addClass('hidden');
        $this.siblings('.showReplyTextArea').removeClass('hidden');
        let commentId = $this.data('cancel-reply-textarea-comment-id');
        $('#replyTextArea_' + commentId).addClass('hidden');
        $('.replyFormBody').val('');
    });

    //==================================================================================================================
    //===================================== textarea expands as user types =============================================
    //==================================================================================================================
    document.addEventListener("input", function (event) {
        if (event.target.tagName.toLowerCase() !== 'textarea') return;
        autoExpand(event.target);
    }, false);

    let autoExpand = function (field) {
        // Do things...
        // Reset field height
        field.style.height = 'inherit';
        // Get the computed styles for the element
        let computed = window.getComputedStyle(field);
        // Calculate the height
        let height = parseInt(computed.getPropertyValue('border-top-width'), 10)
            + parseInt(computed.getPropertyValue('padding-top'), 10)
            + field.scrollHeight
            + parseInt(computed.getPropertyValue('padding-bottom'), 10)
            + parseInt(computed.getPropertyValue('border-bottom-width'), 10);
        field.style.height = height + 'px';
    };

    //==================================================================================================================
    //========================================== comment tree ==========================================================
    //==================================================================================================================

    // if div has more than 5 children, start removing the indentation of the children??

    <!-- =================================================================================================================-->
    <!-- ============================================== SUBMIT Comment ===================================================-->
    <!-- =================================================================================================================-->

    $('.commentSubmitBtn').on("click", function (e) {
        // console.log($('.commentForm').serialize());
        e.preventDefault();

        let commentId = $('.commentWrapper').data('[data-edit-delete-comment-id]');
        let replyFormBody = $('[data-reply-form-body-comment-id=' + commentId + ']');
        replyFormBody.val('');

        let request = $.ajax({
            // crossOrigin: true, //XSS shield.
            url: '/posts/' + $("#postId").val(), // @PostMapping("/posts/{postId}") in PostsController
            method: 'POST',
            dataType: 'html', // I'm returning html from the PostsController method postComment()
            // dataType: 'json',
            data: $('.commentForm').serialize()
        });
        request.done((html) => {
            // request.done((comment) => { // no need for confusion here, not returning a comment, but html.
            //comment id's will always be undefined here because I'm not returning an object, I'm returning html.

            $('#commentFormBody').val(''); // clear the input field.

            // check if html is that error fragment. (html could be both error or comment):
            if (!(html.includes("commentBodyText"))) { // if it's an error...
                $('.commentsErrorAJAX').html(html).hide().fadeIn() // error belongs in the error div.
            }

            if (html.includes("commentBodyText")) { // if it's a comment...
                if ($('.commentsErrorAJAX').length >= 1) { // check if error exists first
                    $('.commentsErrorAJAX').css("display", "none"); // if error exists, hide it.
                }
                $('.commentsAJAX').prepend(html).hide().fadeIn(); // comment belongs in the comment div
            }

            // $('.editedCommentForm').addClass('hidden'); //hide the edit form.
            // $('.replyTextArea').addClass('hidden'); // hide the reply text area.
            $('.showReplyTextAreaCancel').addClass('hidden');
            $('.replyFormBody').val('');
            // $('#commentedBy').css("background-color", "#99999930");

            // let commentId = $('.commentWrapper').data('[data-edit-delete-comment-id]');
            // let $replyFormBody = $('[data-reply-form-body-comment-id=' + commentId + ']');
            // $replyFormBody.val('');

        });

        request.fail((a, b, c) => {
            console.log(a, b, c)
        });
    });

    <!-- =================================================================================================================-->
    <!-- ============================================== EDIT Comment =====================================================-->
    <!-- =================================================================================================================-->

    //The edit button is only an event trigger. When I click on the edit button:
    //A new textarea is revealed in place of the comment.body. Textarea should be populated with the original comment text. (controller)
    //When I click on the new submit button, new data should replace the previous data. (controller)

    container.on("click", ".dropdown-edit-btn", function () {

        let button = $(this);
        let commentId = button.data('edit-btn-comment-id');
        let commentEditForm = $('[data-edit-form-comment-id=' + commentId + ']');
        commentEditForm.removeClass('hidden');
        let showReplyTextArea = $('[data-show-reply-textarea-comment-id=' + commentId + ']');
        showReplyTextArea.addClass('hidden');

        //================================== AJAX ==================================
        let request = $.ajax({
            url: '/posts/' + $("#postId").val() + '/comment/' + commentId + '/edit',
            method: 'GET',
            dataType: 'json',
            contentType: "application/json; charset=utf-8",
            data: commentId
        });
        request.done(function (comment) {

            let commentBody = $('[data-comment-body-comment-id=' + commentId + ']');
            let commentEditForm = $('[data-edit-form-comment-id=' + commentId + ']');
            let commentVoting = $('[data-commentVoting-comment-id=' + commentId + ']');
            let showReplyTextArea = $('[data-show-reply-textarea-comment-id=' + commentId + ']');
            let editBtn = $('[data-edit-btn-comment-id=' + commentId + ']');
            let deleteBtn = $('[data-delete-btn-comment-id=' + commentId + ']');
            let editedCommentBodyText = $('[data-edit-comment-form-textarea-comment-id=' + commentId + ']');

            commentBody.addClass('hidden'); // hide the original comment body
            commentVoting.addClass('hidden'); // hide the comment votes
            editBtn.addClass('hidden'); // hide the edit button
            deleteBtn.addClass('hidden'); // hide the delete button
            commentEditForm.css("display", "block"); // I just want to show "this" edit form
            editedCommentBodyText.text(comment.body); // put the text of comment.body inside the newly visible textarea.

            //================= cancel button ====================
            //====================================================

            $('.editedCommentCancelBtn').on("click", function (e) { // on cancel button click...
                e.preventDefault();

                commentEditForm.addClass('hidden'); // hide the edit form
                commentBody.removeClass('hidden'); // show the original comment back in the html
                commentVoting.removeClass('hidden'); // show the comment votes again
                editBtn.removeClass('hidden');// show the edit button
                deleteBtn.removeClass('hidden');// show the delete button
                showReplyTextArea.removeClass('hidden'); // show the reply again
            })
        });
        request.fail((a, b, c) => {
            console.log(a, b, c)
        });
    });

    <!-- =================================================================================================================-->
    <!-- ============================================ SUBMIT EDITED Comment ==============================================-->
    <!-- =================================================================================================================-->

    container.on("click", ".editedCommentSubmitBtn", function (e) {
        e.preventDefault();

        let button = $(this);
        let commentId = button.parent().parent().data('edit-form-comment-id'); // get id
        // let content = $button.parent().children('textarea').text(); // I don't have to grab the content in the form.
        let commentEditForm = $('[data-edit-form-comment-id=' + commentId + ']'); // because I can just get the form

        let request = $.ajax({
            url: '/posts/' + $("#postId").val() + '/comment/' + commentId + '/edit',
            method: 'POST',
            dataType: 'json',
            data: commentEditForm.serialize()
        });
        request.done(function (comment) {

            let commentBody = $('[data-comment-body-comment-id=' + commentId + ']');
            let commentEditForm = $('[data-edit-form-comment-id=' + commentId + ']');
            let editBtn = $('[data-edit-btn-comment-id=' + commentId + ']');
            let deleteBtn = $('[data-delete-btn-comment-id=' + commentId + ']');
            let commentVoting = $('[data-commentVoting-comment-id=' + commentId + ']');
            let showReplyTextArea = $('[data-show-reply-textarea-comment-id=' + commentId + ']');

            commentEditForm.addClass('hidden'); // hide the edit form
            commentBody.removeClass('hidden').html(comment.body); // show the new updated comment in the html
            commentVoting.removeClass('hidden');
            editBtn.removeClass('hidden');
            deleteBtn.removeClass('hidden');
            showReplyTextArea.removeClass('hidden');
        })
    });

    <!-- =================================================================================================================-->
    <!-- ============================================== DELETE Comment  ==================================================-->
    <!-- =================================================================================================================-->

    container.on("click", ".dropdown-delete-btn", function (e) {
        // use event delegation that targets an elements parent, something, that isn't dynamic: .container
        e.preventDefault(); // prevent default form behavior and instead use ajax.
        let commentInformation = $(this).parent().serialize();
        let button = $(this);
        // Look for element with this attribute. We're looking for siblings(other comments) within the container.
        let commentId = button.siblings('[data-comment-id]').data('comment-id');

        let request = $.ajax({
            url: '/posts/' + $("#postId").val() + '/comment/' + commentId + '/delete',
            method: 'POST',
            data: commentInformation
            // data: JSON.stringify({id: deleteCommentId}),
        });
        request.done(function () {
            $('[data-edit-delete-comment-id=' + commentId + ']').fadeOut("slow", function () {
                $('[data-edit-delete-comment-id=' + commentId + ']').remove(); // new way targets element directly.
            })
            // $button.parent().parent().parent().parent().parent().remove(); // removes from html (old way/bad way)
        });
        request.fail((a, b, c) => {
            console.log(a, b, c)
        });
    });


    <!-- =================================================================================================================-->
    <!-- ============================================== POST VOTING  =====================================================-->
    <!-- =================================================================================================================-->

    postWrapper.on("click", ".postUpvote", function (e) {

        if ($(e.target).hasClass('stayActive')) {
            //remove vote
            let button = $(this);
            let postId = button.parent().data('upvote-post-id');
            let postFormUp = $('[data-upvote-post-id=' + postId + ']');

            let request = $.ajax({
                url: '/posts/' + postId + '/removeVote',
                method: 'POST',
                //dataType: 'json',
                data: postFormUp.serialize()
            });
            request.done(function (post) {

                $('.postVoteCount').html(post.voteCount);
                $('.postUpvote').removeClass("stayActive");
            })
        } else {
            //upvote
            let button = $(this);
            let postId = button.parent().data('upvote-post-id');
            let postFormUp = $('[data-upvote-post-id=' + postId + ']');

            console.log("clicked on post upvote for post: " + postId);

            let request = $.ajax({
                url: postFormUp.attr('action'), //-> postVoting() in PostsController
                method: 'POST',
                data: postFormUp.serialize(),
            });
            request.done(function (post) {

                $('.postVoteCount').html(post.voteCount);
                $('.postDownvote').removeClass("stayActive");
                $('.postUpvote').addClass("stayActive");

                console.log("votecount: " + post.voteCount);
            });

            request.fail((a, b, c) => {
                console.log(a, b, c)
            });
        }
    });

    postWrapper.on("click", ".postDownvote", function (e) {

        if ($(e.target).hasClass('stayActive')) {
            //remove vote
            let button = $(this);
            let postId = button.parent().data('downvote-post-id');
            let postFormDown = $('[data-downvote-post-id=' + postId + ']');

            let request = $.ajax({
                url: '/posts/' + postId + '/removeVote', // -> voteRemoval() in PostsController
                method: 'POST',
                data: postFormDown.serialize()
            });
            request.done(function (post) {

                $('.postVoteCount').html(post.voteCount);
                $('.postDownvote').removeClass("stayActive");
            })
        } else {
            //downvote
            let button = $(this);
            let postId = button.parent().data('downvote-post-id');
            let postFormDown = $('[data-downvote-post-id=' + postId + ']');

            let request = $.ajax({
                url: postFormDown.attr('action'), // -> postVoting() in PostsController
                method: 'POST',
                //dataType: 'json', // returning an object by default
                data: postFormDown.serialize()
            });
            request.done(function (post) {

                $('.postVoteCount').html(post.voteCount);
                $('.postUpvote').removeClass("stayActive");
                $('.postDownvote').addClass("stayActive");

                console.log(post.voteCount);

            });

            request.fail((a, b, c) => {
                console.log(a, b, c)
            });
        }
    });

    <!-- =================================================================================================================-->
    <!-- ============================================== COMMENT VOTING  ==================================================-->
    <!-- =================================================================================================================-->

    container.on("click", ".commentUpvote", function (e) {
        e.preventDefault();

        if ($(e.target).hasClass('stayActive')) {
            //remove vote
            let button = $(this);
            let commentId = button.parent().data('upvote-comment-id');
            let commentFormUp = $('[data-upvote-comment-id=' + commentId + ']');

            let request = $.ajax({
                url: '/comment/' + commentId + '/removeVote',
                method: 'POST',
                dataType: 'json',
                data: commentFormUp.serialize()
            });
            request.done(function (comment) {

                let commentUpIcon = $('[data-upvoteIcon-comment-id=' + commentId + ']');
                let commentVoteCount = $('[data-voteCount-comment-id=' + commentId + ']');

                commentVoteCount.html(comment.voteCount);
                commentUpIcon.removeClass("stayActive");
            })
        } else {
            //upvote
            let button = $(this);
            let commentId = button.parent().data('upvote-comment-id');
            let commentFormUp = $('[data-upvote-comment-id=' + commentId + ']');

            let request = $.ajax({
                url: commentFormUp.attr('action'), //-> commentVoting() in PostsController using the action path in the form element
                method: 'POST',
                data: commentFormUp.serialize()
            });
            request.done(function (comment) {

                let commentUpIcon = $('[data-upvoteIcon-comment-id=' + commentId + ']');
                let commentDownIcon = $('[data-downvoteIcon-comment-id=' + commentId + ']');
                let commentVoteCount = $('[data-voteCount-comment-id=' + commentId + ']');

                commentVoteCount.html(comment.voteCount);
                commentDownIcon.removeClass("stayActive");
                commentUpIcon.addClass("stayActive");
            })
        }
    });

    container.on("click", ".commentDownvote", function (e) {
        e.preventDefault();

        if ($(e.target).hasClass('stayActive')) {
            //remove vote
            let button = $(this);
            let commentId = button.parent().data('downvote-comment-id');
            let commentFormUp = $('[data-downvote-comment-id=' + commentId + ']');

            let request = $.ajax({
                url: '/comment/' + commentId + '/removeVote',
                method: 'POST',
                dataType: 'json',
                data: commentFormUp.serialize()
            });
            request.done(function (comment) {

                let commentDownIcon = $('[data-downvoteIcon-comment-id=' + commentId + ']');
                let commentVoteCount = $('[data-voteCount-comment-id=' + commentId + ']');

                commentVoteCount.html(comment.voteCount);
                commentDownIcon.removeClass("stayActive");
            })
        } else {
            //downvote
            let button = $(this);
            let commentId = button.parent().data('downvote-comment-id');
            let commentFormDown = $('[data-downvote-comment-id=' + commentId + ']');

            let request = $.ajax({
                url: commentFormDown.attr('action'),
                method: 'POST',
                data: commentFormDown.serialize()
            });
            request.done(function (comment) {

                let commentUpIcon = $('[data-upvoteIcon-comment-id=' + commentId + ']');
                let commentDownIcon = $('[data-downvoteIcon-comment-id=' + commentId + ']');
                let commentVoteCount = $('[data-voteCount-comment-id=' + commentId + ']');

                commentVoteCount.html(comment.voteCount);
                commentUpIcon.removeClass("stayActive");
                commentDownIcon.addClass("stayActive");
            })
        }
    });

    <!-- =================================================================================================================-->
    <!-- ============================================== REPLY TO COMMENTS  ===============================================-->
    <!-- =================================================================================================================-->

    container.on("click", ".commentReplyBtn", function (e) {
        e.preventDefault();

        let button = $(this);
        let commentId = button.data('reply-submit-btn-comment-id');
        let replyForm = $('[data-reply-form-comment-id=' + commentId + ']');

        $('#replyTextArea_' + commentId).addClass('hidden');

        let request = $.ajax({
            url: replyForm.attr('action'),
            method: 'POST',
            data: replyForm.serialize()
        });
        request.done((html) => {

            let replyWrapper = $('[data-wrapper-reply-textarea-comment-id=' + commentId + ']');
            let replyError = $('[data-reply-error-comment-id=' + commentId + ']');
            let replyForm = $('[data-reply-form-comment-id=' + commentId + ']');
            let replyFormBody = $('[data-reply-form-body-comment-id=' + commentId + ']');
            let showReplyTextArea = $('[data-show-reply-textarea-comment-id=' + commentId + ']');
            let cancelReply = $('[data-cancel-reply-textarea-comment-id=' + commentId + ']');
            let commentEditForm = $('[data-edit-form-comment-id=' + commentId + ']');
            let childCommentDiv = $('[data-child-node-comment-id=' + commentId + ']');

            // if statement here to check if html is that error fragment. (html could be both error or comment)
            if (!(html.includes("commentBodyText"))) { // if html is an error,
                // $('.repliesErrorAJAX').html(html).hide().fadeIn() // error belongs in the error div.
                replyError.html(html); // error belongs in the error div.

                showReplyTextArea.addClass('hidden');
                cancelReply.removeClass('hidden');
                replyWrapper.removeClass('hidden');
                replyForm.removeClass('hidden');
                replyFormBody.removeClass('hidden');
                console.log("the response was an error. error validation in place.")
            }

            if (html.includes("commentBodyText")) { // if html is a comment...
                if (replyError.length >= 1) { // check if error exists first
                    replyError.addClass('hidden'); // if error exists, hide it.
                    replyFormBody.val('');
                    showReplyTextArea.removeClass('hidden');
                    commentEditForm.addClass('hidden'); //hide the edit form.
                    replyWrapper.addClass('hidden'); // hide the reply text area.
                    console.log("response was a comment.");
                    cancelReply.addClass('hidden');
                }
                childCommentDiv.append(html).hide().fadeIn(1500); //append the comment in the childCommentDiv

                //scroll to reply when commented
                $('html, body').animate({
                    scrollTop: childCommentDiv.offset().top - $(window).height() / 2
                }, 100);
            }
            replyFormBody.val('');
        });

        request.fail((a, b, c) => {
            console.log(a, b, c)
        });

    })

</script>
</body>
</html>


<!--<div class="childCommentDiv" style="margin-left: 2em;" th:attr="data-child-node-comment-id=${comment.id}"></div>-->
