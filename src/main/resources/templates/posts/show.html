<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:include="fragments/header :: my-header('To Geek Is Human - Show Post - ' + ${post.title})">
</head>
<body>
<nav th:include="fragments/navbar :: my-navbar"></nav>

<a href="#" class="scrollUp"><i class="fas fa-arrow-circle-up"></i></a>

<div class="showPageWrapper">
    <!-- ================================================================================================================-->
    <!-- ====================================================  SHOW THE POST ============================================-->
    <!-- ================================================================================================================-->
    <div class="image-top-show-page-mobile">
        <p th:utext="${post.htmlImage}"></p>
    </div>

    <div class="postWrapper-showPage">

            <div class="postInfoWrapper">
                <div class="indent">
                    <!-- BEFORE allowing markdown editing for titles:-->
                    <!--<h4 th:text="${post.title}" class="postTitle no-text-decoration">-->
                    <!--AFTER allowing markdown editing for titles. Uses new property in Post class and th:utext-->
                    <!--<h4 th:utext="${post.htmlTitle}" class="postTitle no-text-decoration"></h4>-->
                    <!-- OR call the method directly:-->
                    <!-- th:title for SEO -->
                    <h1 th:utext="${post.getHtmlTitle()}" class="no-text-decoration" id="post-title-show-page" th:title="${post.title}"></h1>

                    <!--<div class="post-subtitle-show-page margin-top-bottom indent">-->
                        <!--<p th:utext="${post.htmlSubtitle}"></p>-->
                    <!--</div>-->

                    <div class="post-info-wrapper-mobile">
                        <a class="flex-center" th:href="@{/profile/{id}/{username}(id=${post.user.id}, username=${formatter.makeSlug(post.user.username)})}" th:title="${post.user.username}">
                            <div class="profile-pic-wrapper-show-page">
                                <span th:if="${post.user.profilePicture} == null">
                                    <img class="profile-pic-show-page profile-pic-show-page-mobile" src="/../images/default_user.png" th:title="${post.user.username}"/>
                                </span>
                                <span th:if="${post.user.profilePicture} != null">
                                    <img class="profile-pic-show-page profile-pic-show-page-mobile" th:src="@{'/uploads/' + ${post.user.profilePicture}}" th:title="${post.user.username}"/>
                                </span>
                            </div>
                        </a>

                        <div class="post-info-name-date-wrapper">

                            <div>By: <a class="postedByNameTextIndex" th:href="@{/profile/{id}/{username}(id=${post.user.id}, username=${formatter.makeSlug(post.user.username)})}" th:title="${post.user.username}">
                                <span th:text="${post.user.username}"></span></a>
                                <div class="float-right">
                                    <span class="postedByDateTime" th:text="${#temporals.format(post.date,  'h:mm a')}"></span>
                                    <span class="postedByDate" th:text="${#temporals.monthNameShort(post.date)}"></span>
                                    <span class="postedByDate" th:text="${#temporals.day(post.date)}"></span>
                                    <span class="postedByDate" th:text="${#temporals.year(post.date)}"></span>
                                </div>

                                <div>
                                    <a class="post-tag" th:each="tag : ${post.getCategories()}" th:text="${tag.name}" th:href="@{/posts/search(term=${tag.name})}"></a>
                                    <!--<span class="sidebar-category-tags"><a th:each="tag : ${post.getCategories()}" th:text="${tag.name}" th:href="@{/posts/search(term=${tag.name})}"></a></span>-->
                                    <span class="margin-left">
                                        <i class="fas fa-thumbs-up post-info-fa-icon"></i>
                                        <h5 class="post-info-count" id="post-info-vote-count" th:text="${formatter.formatCount(post.voteCount())}"></h5>
                                        <a id="cmt-sec-ahref-link" href="#voting-area">
                                            <i class="fas fa-comments post-info-fa-icon"></i>
                                            <h5 class="post-info-count" th:text="${formatter.formatCount(post.getComments().size())}"></h5>
                                        </a>
                                        <i class="fas fa-eye post-info-fa-icon"></i>
                                        <h5 class="post-info-count" th:text="${post.hitCount != null} ? ${formatter.formatCount(post.hitCount.postCount)} : '0'"></h5>
                                        <!--<i class="far fa-share-square post-info-fa-icon"></i>-->
                                        <!--<h5 class="post-info-fa-count">Share</h5>-->
                                    </span>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <!-- ======================================== Post Body ======================================-->

                <div class="postDescription hidden show-all-content" th:if="${!isDisabled}">
                    <div class="headline-image">
                        <p th:utext="${post.htmlImage}"></p>
                    </div>
                    <div class="post-subtitle-show-page margin-top-bottom indent">
                        <p th:utext="${post.htmlSubtitle}"></p>
                    </div>
                    <p th:utext="${post.htmlDescription}"></p> <!--th:utext for markdown editor, not th:text-->
                </div>

                <!-- ====================================== Post Voting ======================================-->
                <div class="post-vote-options-row" id="voting-area">

                    <div class="postVoting" th:if="${!isDisabled}">
                        <div class="upvoteDiv">

                            <div th:if="${!isLoggedIn}">
                                <i class="fas fa-thumbs-up commentVoteNotLoggedIn"></i>
                            </div>

                            <div th:if="${isLoggedIn} and ${!isBanned}">
                                <form th:action="@{/posts/upvote/{postId}(postId=${post.id})}" method='POST'
                                      th:attr="data-upvote-post-id=${post.id}">
                                    <i th:classappend="${upvote} ? stayActive : postUpvote"
                                       class="fas fa-thumbs-up postUpvote" th:if="${isLoggedIn}"></i>
                                    <!--when clicked, stayActive class will be added or removed.-->
                                </form>
                            </div>
                        </div>

                        <div class="voteCountDiv">
                            <h5>
                                <span class="postVoteCount" th:if="${!isLoggedIn} or (${isLoggedIn} and ${!isBanned})" th:text="${formatter.formatCount(post.voteCount())}" th:attr="data-voteCount-post-id=${post.id}"></span>
                            </h5>
                        </div>

                        <div class="downvoteDiv">

                            <div th:if="${isLoggedIn} and ${!isBanned}">
                                <form th:action="@{/posts/downvote/{postId}(postId=${post.id})}" method='POST'
                                      th:attr="data-downvote-post-id=${post.id}">
                                    <i th:classappend="${downvote} ? stayActiveDown : postDownvote"
                                       class="fas fa-thumbs-down postDownvote" th:if="${isLoggedIn}"></i>
                                </form>
                            </div>

                            <div th:if="${!isLoggedIn}">
                                <i class="fas fa-thumbs-down commentVoteNotLoggedIn"></i>
                            </div>

                        </div>
                    </div>

                    <!-- ====================================== Post Edit and Delete Buttons =====================-->

                    <div th:if="${isPostOwner} or ${#authorization.expression('hasRole(''ROLE_ADMIN'')')}">
                        <i class="fas fa-ellipsis-h fa-lg comment-ellipsis dropdown-toggle margin-left-large"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        </i>
                        <div class="dropdown-menu edit-delete-dropdown" aria-labelledby="dropdownMenu">
                            <div>
                                <a class="dropdown-edit-btn"  th:href="${'/posts/' + post.id + '/edit'}">
                                    <i class="far fa-edit"></i> edit
                                </a>
                            </div>
                            <div>
                                <form th:action="@{'/posts/' + ${post.id} + '/delete'}" method="post" class="deleteCommentForm">
                                    <button class="dropdown-delete-btn" type="submit">
                                        <i class="fas fa-bomb"></i> delete
                                    </button>
                                </form>
                            </div>

                            <div sec:authorize="hasRole('ROLE_ADMIN')" th:if="${!isDisabled}" class="deleteCommentForm">
                                <form th:action="@{'/posts/' + ${post.id} + '/disable'}" method="post">
                                    <button class="dropdown-delete-btn">
                                        <i class="fas fa-lock"></i> disable
                                    </button>
                                </form>
                            </div>
                            <div sec:authorize="hasRole('ROLE_ADMIN')" th:if="${isDisabled}" class="deleteCommentForm">
                                <form th:action="@{'/posts/' + ${post.id} + '/enable'}" method="post">
                                    <button class="dropdown-delete-btn">
                                        <i class="fas fa-lock-open"></i> enable
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- AddToAny BEGIN -->
                    <div th:if="${!isDisabled}" class="a2a_kit a2a_kit_size_24 a2a_default_style margin-left-auto margin-right">
                        <a class="a2a_button_facebook"></a>
                        <a class="a2a_button_twitter"></a>
                        <a class="a2a_button_reddit"></a>
                        <a class="a2a_button_google_gmail"></a>
                        <a class="a2a_button_copy_link"></a>
                    </div>
                    <script src="https://static.addtoany.com/menu/page.js"></script>
                    <!-- AddToAny END -->

                </div>

                <div th:if="${!isLoggedIn and !isDisabled}" class="replyPostNotLoggedInWrapper margin-top-bottom">
                    <div class="replyPostNotLoggedInDiv">
                        <div class="replyPostNotLoggedInText">You must be <span><a class="replyPostNotLoggedInLink" th:href="${'/login'}">logged in</a></span> to join the conversation.</div>
                    </div>
                </div>

                <!-- ================================================================================================================-->
                <!--============================================== FORM for COMMENTS ================================================-->
                <!-- ================================================================================================================-->
                <div class="alert alert-info" th:if="${isDisabled}"><i class="fas fa-lock margin-right-lite"></i>This post is currently locked.</div>
                <div class="profileLoggedInMessage margin-top-bottom alert alert-danger flex-center" th:if="${isBanned}">
                    <i class="fas fa-exclamation-triangle"></i>
                    You are currently BANNED. You are prohibited from voting or commenting.
                </div>
                <div th:if="${!isDisabled} and (${isLoggedIn} and ${!isBanned})" class="commentFormWrapper margin-left-right">
                    <!--sec:authorize="isAuthenticated()"-->
                    <form th:action="${'/posts/' + post.id}" method="post" th:object="${comment}" class="commentForm">
                        <div class="form-group">
                            <label for="commentFormBody"></label>
                            <textarea class="form-control" id="commentFormBody" name="body"
                                      th:field="*{body}"
                                      th:placeholder="Comment...">
                            </textarea>
                            <div class="commentsErrorAJAX"></div>
                            <!-- ======================== submit comment ================================-->

                            <input class="form-control" type="hidden" id="postId" th:value="${post.id}"/>
                            <button class="btn btn-primary commentSubmitBtn">
                                <i class="far fa-comment-alt"></i> Comment
                            </button>
                        </div>
                    </form>
                </div>


                <div class="flex">
                    <div class="replyPostNotLoggedInText margin-right">Discussion</div>
                    <div>
                        <i class="fas fa-comments post-info-fa-icon margin-right-lite"></i>
                        <h5 class="post-info-count" id="discussion-count" th:text="${formatter.formatCount(post.getComments().size())} + ' COMMENTS'"></h5>
                    </div>
                </div>


            </div>
        </div>


    <!-- ================================================================================================================-->
    <!--============================================= SHOW ALL COMMENTS =================================================-->
    <!-- ================================================================================================================-->

    <hr id="commentHRLeader"/>

    <div class="container commentSection commentsAJAX"></div>
    <!-- This div will prepend with new ajax html. It should not be targeted otherwise -->
    <div th:if="${!isDisabled}" class="container commentSection" th:each="comment : ${comments}" th:data="*{comment}">
        <!--// PAGINATION-->
        <!--<div class="container commentSection" th:each="comment : ${page}" th:data="*{page}">-->
        <!--PAGINATION \\-->
        <th:block th:include="fragments/comments :: comment"></th:block>

        <!--th:attr allows me to target this element specifically in show.html's ajax request-->
        <div class="commentWrapper" th:attr="data-edit-delete-comment-id=${comment.id}">
            <!-- this div should be targeted with unique th:attr -->
            <a th:href="@{/profile/{id}/{username}(id=${comment.user.id}, username=${formatter.makeSlug(comment.user.username)})}">
                <div class="commentPicWrapper">
                    <span th:if="${comment.user.profilePicture} == null">
                        <img class="profilePicComment" src="/../images/default_user.png"/>
                    </span>
                    <span th:if="${comment.user.profilePicture} != null">
                        <img class="profilePicComment" th:src="@{'/uploads/' + ${comment.user.profilePicture}}"/>
                    </span>
                </div>
            </a>

            <div class="commentInfoWrapper speech-bubble">

                    <h5 th:classappend="${isParentComment} ? parentCommentStyling : commentedByStyling">
                        <a th:href="@{/profile/{id}/{username}(id=${comment.user.id}, username=${formatter.makeSlug(comment.user.username)})}" style="text-decoration: none;">
                            <span class="commentedByNameText" th:text="${comment.user.username}"></span>
                        </a>
                        <span class="comment-info-date-wrapper">
                            <span class="commentedByDateTime" th:text="${#temporals.format(comment.date,  'h:mm a')}"
                                  style="margin-right: 0.75em;"></span>
                            <span class="commentedByDate" th:text="${#temporals.monthNameShort(comment.date)}"></span>
                            <span class="commentedByDate" th:text="${#temporals.day(comment.date)}">,</span>
                            <span class="commentedByDate" th:text="${#temporals.year(comment.date)}"></span>
                        </span>

                        <span class="comment-info-date-mobile-wrapper">
                            <div class="comment-info-mobile">
                                <span class="commentedByDateTime" th:text="${#temporals.format(comment.date,  'h:mm a')}"
                                      style="margin-right: 0.75em;"></span>
                                <span class="commentedByDate" th:text="${#temporals.monthNameShort(comment.date)}"></span>
                                <span class="commentedByDate" th:text="${#temporals.day(comment.date)}">,</span>
                                <span class="commentedByDate" th:text="${#temporals.year(comment.date)}"></span>
                            </div>
                        </span>
                    </h5>

                <!-- =============================== Comment Body =========================-->

                <div class="commentBodyWrapper">
                    <span th:text="${comment.body}" class="commentBodyText"
                        th:attr="data-comment-body-comment-id=${comment.id}">
                    </span>
                </div>

                <!-- =============================== Edit Form ============================-->

                <div class="editedCommentFormWrapper">
                    <form
                            th:action="@{/posts/comment/{commentId}/edit(commentId=${comment.id})}"
                            method="POST"
                            th:object="${comment}"
                            class="editedCommentForm hidden" id="editedCommentFormId"
                            th:attr="data-edit-form-comment-id=${comment.id}">

                        <textarea class="form-control editedCommentBodyText" name="body"
                                  th:attr="data-edit-comment-form-textarea-comment-id=${comment.id}"
                                  th:value="${comment.body}">
                        </textarea>

                        <input type="hidden" name="id" th:value="${comment.id}"/>

                        <div class="editAndDeleteBtnsRow">

                            <button class="btn btn-primary editedCommentCancelBtn">
                                CANCEL
                            </button>

                            <button class="btn btn-primary editedCommentSubmitBtn">
                                SAVE
                            </button>

                        </div>
                    </form>
                </div>

                <!-- =============================== Comment Votes =========================-->

                <div class="comment-vote-reply-options-row" th:attr="data-comment-vote-reply-options-id=${comment.id}">
                    <div class="commentVoting" th:attr="data-commentVoting-comment-id=${comment.id}">

                        <div class="upvoteDiv">

                            <div th:if="${!isLoggedIn}">
                                <i class="fas fa-thumbs-up commentVoteNotLoggedIn"></i>
                            </div>

                            <div  th:if="${isLoggedIn} and ${!isBanned}">
                                <form th:action="@{/comment/upvote/{commentId}(commentId=${comment.id})}" method="POST"
                                      th:attr="data-upvote-comment-id=${comment.id}">
                                    <i th:classappend="${comment.getVoteFrom(#authentication.principal) != null &amp;&amp; comment.getVoteFrom(#authentication.principal).isUpvote()} ? stayActive : commentUpvote"
                                       class="fas fa-thumbs-up commentUpvote"
                                       th:if="${isLoggedIn}" th:attr="data-upvoteIcon-comment-id=${comment.id}"></i>
                                </form>
                            </div>
                        </div>

                        <div class="voteCountDiv">
                            <h5>
                                <span class="commentVoteCount" th:text="${formatter.formatCount(comment.voteCount())}"
                                      th:attr="data-voteCount-comment-id=${comment.id}" th:if="${!isLoggedIn} or (${isLoggedIn} and ${!isBanned})"></span>
                            </h5>
                        </div>

                        <div class="downvoteDiv">
                            <div  th:if="${isLoggedIn} and ${!isBanned}">
                                <form th:action="@{/comment/downvote/{commentId}(commentId=${comment.id})}" method="POST"
                                      th:attr="data-downvote-comment-id=${comment.id}">
                                    <i th:classappend="${comment.getVoteFrom(#authentication.principal) != null &amp;&amp; comment.getVoteFrom(#authentication.principal).isDownvote()} ? stayActiveDown : commentDownvote"
                                       class="fas fa-thumbs-down commentDownvote"
                                       th:if="${isLoggedIn}" th:attr="data-downvoteIcon-comment-id=${comment.id}"></i>
                                </form>
                            </div>

                            <div th:if="${!isLoggedIn}">
                                <i class="fas fa-thumbs-down commentVoteNotLoggedIn"></i>
                            </div>

                        </div>
                    </div>

                    <!--================================== REPLY TO A COMMENT ===========================================-->
                    <!--=================================================================================================-->


                    <h5 th:if="${!isLoggedIn}" class="replyCommentNotLoggedInDiv"><span><a class="replyCommentNotLoggedInLink" th:href="${'/login'}">LOGIN</a></span></h5>

                    <div th:if="${isLoggedIn} and ${!isBanned}" class="flex-center">

                        <h5 class="showReplyTextArea" th:attr="data-show-reply-textarea-comment-id=${comment.id}">
                            <!--data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">-->
                            <i class="fas fa-reply flipped-reply"></i> REPLY
                        </h5>
                        <h5 class="showReplyTextAreaCancel hidden" th:attr="data-cancel-reply-textarea-comment-id=${comment.id}">
                            <i class="fas fa-times"></i> CANCEL
                        </h5>

                    </div>

                    <!--==================================== EDIT AND DELETE DROPDOWN ===================================-->
                    <!--=================================================================================================-->

                    <div sec:authorize="isAuthenticated()" th:if="${!isBanned} and (${comment.isOwnedBy(#authentication.principal.id)} or ${#authorization.expression('hasRole(''ROLE_ADMIN'')')})"
                         th:attr="id=${'ellipsis_' + comment.id}" class="flex-center comment-ellipsis-div">
                        <i class="fas fa-ellipsis-h fa-lg comment-ellipsis dropdown-toggle"
                               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        </i>
                        <div class="dropdown-menu edit-delete-dropdown" aria-labelledby="dropdownMenu">

                            <div>
                                <a class="dropdown-edit-btn" th:attr="data-edit-btn-comment-id=${comment.id}">
                                    <i class="far fa-edit"></i> edit
                                </a>
                            </div>
                            <div>
                                <form th:action="@{/posts/comment/{commentId}/delete(commentId=${comment.id})}"
                                method="POST"
                                th:object="${comment}"
                                class="deleteCommentForm">

                                    <input type="hidden" name="id" th:attr="data-comment-id=${comment.id}" th:value="${comment.id}"/>

                                    <button class="dropdown-delete-btn" th:attr="data-delete-btn-comment-id=${comment.id}">
                                        <i class="fas fa-bomb"></i> delete
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div sec:authorize="isAuthenticated()" th:if="${!isBanned} and (${!comment.isOwnedBy(#authentication.principal.id)} or ${#authorization.expression('hasRole(''ROLE_ADMIN'')')})"
                         th:attr="id=${'ellipsis_' + comment.id}" class="flex-center comment-ellipsis-div">

                        <i class="fas fa-ellipsis-h fa-lg comment-ellipsis dropdown-toggle"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        </i>

                        <div class="dropdown-menu edit-delete-dropdown report-dropdown" aria-labelledby="dropdownMenu">
                            <form th:action="@{/comment/{id}/flag(id=${comment.id})}" method="POST"
                                  th:object="${comment}"
                                  th:attr="data-flag-comment-form-id=${comment.id}"
                            class="flagCommentForm">

                                <input type="hidden" name="id" th:attr="data-flag-comment-id=${comment.id}" th:value="${comment.id}"/>

                                <div th:if="${!comment.userIdsWhoHaveFlagged().contains(loggedInUser.getId())}" class="dropdown-report-btn" th:attr="data-flag-comment-id=${comment.id}">
                                    <i class="fab fa-font-awesome-flag"></i> report
                                </div>

                                <div th:if="${comment.userIdsWhoHaveFlagged().contains(loggedInUser.getId())}" class="dropdown-report-btn" th:attr="data-flag-comment-id=${comment.id}">
                                    <i class="fas fa-check"></i> reported
                                </div>

                            </form>
                        </div>
                    </div>

                </div>

                <div class="replyTextArea hidden" th:attr="id=${'replyTextArea_' + comment.id}">
                    <!--th:attr="data-wrapper-reply-textarea-comment-id=${comment.id}"-->

                    <form th:action="@{/posts/{postId}/comment/{commentId}/reply(postId=${post.id},commentId=${comment.id})}"
                          method="post"
                          th:object="${comment}"
                          th:attr="data-reply-form-comment-id=${comment.id}">
                        <div class="form-group">
                            <label for="replyFormBody"></label>

                            <textarea contenteditable="true" class="form-control replyFormBody" id="replyFormBody" name="body"
                                      th:field="*{body}"
                                      th:attr="data-reply-form-body-comment-id=${comment.id}">
                            </textarea>

                            <input class="form-control" type="hidden" name="id" th:field="*{id}"/>
                            <button class="btn btn-primary commentReplyBtn"
                                    th:attr="data-reply-submit-btn-comment-id=${comment.id}">
                                <i class="far fa-comment-alt"></i> Reply
                            </button>
                            <div class="repliesErrorAJAX" th:attr="data-reply-error-comment-id=${comment.id}"></div>
                        </div>
                    </form>
                </div>

            </div><!--end of commentInfoWrapper-->
        </div>

        <!--SHOW CHILD COMMENTS UNDERNEATH PARENT COMMENT:-->
        <div class="eachChildCommentDiv indent-comment" th:each="child : ${comment.getChildrenComments()}">
            <div class="child-comment" th:include="fragments/comments :: ajaxComment(comment=${child})"></div>
        </div>


        <!--ALL NEW CHILD COMMENTS COMING IN ARE APPENDED HERE-->
        <div class="childCommentDiv indent-comment" th:attr="data-child-node-comment-id=${comment.id}"></div>

        <hr class="commentHR"/>
    </div>
</div>

<footer th:include="fragments/footer :: my-footer"></footer>
<script>

    // ======================================= EMOJI INIT =======================================
    $("#commentFormBody").emojioneArea({
        pickerPosition: "left",
        tonesStyle: "bullet"
    });
    // https://github.com/mervick/emojionearea#usage

    $('.emojionearea-editor').empty();
    // ==========================================================================================

    let postWrapper = $('.postWrapper-showPage');
    let container = $('.container');
    $('#srch-term').val('');

    //==================================================================================================================
    //===================================== Click Reply, Text Changes to Cancel, Vice Versa ============================
    //==================================================================================================================
    //click on Reply, text changes to Cancel and opens textarea for reply form:
    container.on("click", ".showReplyTextArea", function () {

        let $this = $(this);
        $this.addClass('hidden');
        $this.siblings('.showReplyTextAreaCancel').removeClass('hidden');
        let commentId = $this.data('show-reply-textarea-comment-id');
        $('#replyTextArea_' + commentId).removeClass('hidden');
        $('.showReplyTextArea').prop('disabled', true);
        $('.replyFormBody').val('').focus();

        // send an ajax request to retrieve the username of the owner of the post?:
        // $.get( '/posts/retrieveUsername/comment/' + commentId, function(user) {
        //     $('.replyFormBody').val('@' + user.username + '   ');
        // });
    });

    //click on Cancel, text changes to Reply and closes textarea for reply form:
    container.on("click", ".showReplyTextAreaCancel", function () {

        $('.showReplyTextArea').prop('disabled', false);
        let $this = $(this);
        $this.addClass('hidden');
        $this.siblings('.showReplyTextArea').removeClass('hidden');
        let commentId = $this.data('cancel-reply-textarea-comment-id');
        $('#replyTextArea_' + commentId).addClass('hidden');
        $('.replyFormBody').val('');
    });

    //==================================================================================================================
    //===================================== textarea expands as user types =============================================
    //==================================================================================================================
    // document.addEventListener("input", function (event) {
    //     if (event.target.tagName.toLowerCase() !== 'textarea') return;
    //     autoExpand(event.target);
    // }, false);
    //
    // let autoExpand = function (field) {
    //     // Do things...
    //     // Reset field height
    //     field.style.height = 'inherit';
    //     // Get the computed styles for the element
    //     let computed = window.getComputedStyle(field);
    //     // Calculate the height
    //     let height = parseInt(computed.getPropertyValue('border-top-width'), 10)
    //         + parseInt(computed.getPropertyValue('padding-top'), 10)
    //         + field.scrollHeight
    //         + parseInt(computed.getPropertyValue('padding-bottom'), 10)
    //         + parseInt(computed.getPropertyValue('border-bottom-width'), 10);
    //     field.style.height = height + 'px';
    // };
    //==================================================================================================================
    //====================================== hover over to reveal ellipsis =============================================
    //==================================================================================================================

    let hoverEllipsis = ()=> {
        $('.comment-ellipsis-div').addClass('hidden');
        $('.commentWrapper').on({
            mouseenter: function () {
                //stuff to do on mouse enter
                let $this = $(this);
                let commentId = $this.data('edit-delete-comment-id');
                $('#ellipsis_' + commentId).removeClass('hidden');
            },
            mouseleave: function () {
                //stuff to do on mouse leave
                let $this = $(this);
                let commentId = $this.data('edit-delete-comment-id');
                $('#ellipsis_' + commentId).addClass('hidden');
            }
        });
    };
    hoverEllipsis();

    <!-- =================================================================================================================-->
    <!-- ============================================== SUBMIT Comment ===================================================-->
    <!-- =================================================================================================================-->

    $('.commentSubmitBtn').on("click", function (e) {
        // console.log($('.commentForm').serialize());
        e.preventDefault();

        let commentId = $('.commentWrapper').data('[data-edit-delete-comment-id]');
        let replyFormBody = $('[data-reply-form-body-comment-id=' + commentId + ']');
        replyFormBody.val('');

        let request = $.ajax({
            // crossOrigin: true, //XSS shield.
            url: '/posts/' + $("#postId").val(), // @PostMapping("/posts/{postId}") in PostsController
            method: 'POST',
            dataType: 'html', // I'm returning html from the PostsController method postComment()
            // dataType: 'json', // I'm not returning json
            data: $('.commentForm').serialize()
        });
        request.done((html) => {
            // request.done((comment) => { // no need for confusion here, not returning a comment, but html.
            //comment id's will always be undefined here because I'm not returning an object, I'm returning html.

            $('#commentFormBody').val(''); // clear the input field.
            $('.emojionearea-editor').empty(); // clear the input field (after the added emoji functionality)

            // check if html is that error fragment. (html could be both error or comment):
            if (!(html.includes("commentBodyText"))) { // if it's an error...
                $('.commentsErrorAJAX').html(html).hide().fadeIn() // error belongs in the error div.
            }

            if (html.includes("commentBodyText")) { // if it's a comment...
                if ($('.commentsErrorAJAX').length >= 1) { // check if error exists first
                    $('.commentsErrorAJAX').css("display", "none"); // if error exists, hide it.
                }
                $('.commentsAJAX').prepend(html).hide().fadeIn(); // comment belongs in the comment div
                // $('.editedCommentForm').addClass('hidden'); //hide the edit form.
                // $('.replyTextArea').addClass('hidden'); // hide the reply text area.
                $('.showReplyTextAreaCancel').addClass('hidden');
                $('.replyFormBody').val('');
                // $('#commentedBy').css("background-color", "#99999930");

                // let commentId = $('.commentWrapper').data('[data-edit-delete-comment-id]');
                // let $replyFormBody = $('[data-reply-form-body-comment-id=' + commentId + ']');
                // $replyFormBody.val('');

            }
        });
        request.fail((a, b, c) => {
            console.log(a, b, c)
        });
    });

    <!-- =================================================================================================================-->
    <!-- ============================================== EDIT Comment =====================================================-->
    <!-- =================================================================================================================-->

    container.on("click", ".dropdown-edit-btn", function () {

        let button = $(this);
        let commentId = button.data('edit-btn-comment-id');
        let commentEditForm = $('[data-edit-form-comment-id=' + commentId + ']');
        let ellipsis = $('#ellipsis_' + commentId);
        let showReplyTextArea = $('[data-show-reply-textarea-comment-id=' + commentId + ']');
        commentEditForm.removeClass('hidden');
        showReplyTextArea.addClass('hidden');
        $('.commentWrapper').unbind('mouseenter mouseleave');
        ellipsis.addClass('hidden');

        //================================== AJAX ==================================
        let request = $.ajax({
            url: '/posts/comment/' + commentId + '/edit',
            method: 'GET',
            dataType: 'json',
            contentType: "application/json; charset=utf-8",
            data: commentId
        });
        request.done(function (comment) {

            let commentBody = $('[data-comment-body-comment-id=' + commentId + ']');
            let commentEditForm = $('[data-edit-form-comment-id=' + commentId + ']');
            let commentVoting = $('[data-commentVoting-comment-id=' + commentId + ']');
            let showReplyTextArea = $('[data-show-reply-textarea-comment-id=' + commentId + ']');
            let editedCommentBodyText = $('[data-edit-comment-form-textarea-comment-id=' + commentId + ']');

            commentBody.addClass('hidden'); // hide the original comment body
            commentVoting.addClass('hidden'); // hide the comment votes
            commentEditForm.css("display", "block"); // I just want to show "this" edit form
            editedCommentBodyText.text(comment.body); // put the text of comment.body inside the newly visible textarea.

            //================= cancel button ====================
            //====================================================

            $('.editedCommentCancelBtn').on("click", function (e) { // on cancel button click...
                e.preventDefault();

                commentEditForm.addClass('hidden'); // hide the edit form
                commentBody.removeClass('hidden'); // show the original comment back in the html
                commentVoting.removeClass('hidden'); // show the comment votes again
                showReplyTextArea.removeClass('hidden'); // show the reply again
                ellipsis.removeClass('hidden'); //show ellipsis option dropdown again
                hoverEllipsis();
            })
        });
        request.fail((a, b, c) => {
            console.log(a, b, c)
        });
    });

    <!-- =================================================================================================================-->
    <!-- ============================================ SUBMIT EDITED Comment ==============================================-->
    <!-- =================================================================================================================-->

    container.on("click", ".editedCommentSubmitBtn", function (e) {
        e.preventDefault();

        let button = $(this);
        let commentId = button.parent().parent().data('edit-form-comment-id'); // get id
        // let content = $button.parent().children('textarea').text(); // I don't have to grab the content in the form.
        let commentEditForm = $('[data-edit-form-comment-id=' + commentId + ']'); // because I can just get the form

        let request = $.ajax({
            url: '/posts/comment/' + commentId + '/edit',
            method: 'POST',
            dataType: 'json',
            data: commentEditForm.serialize()
        });
        request.done(function (comment) {

            let commentBody = $('[data-comment-body-comment-id=' + commentId + ']');
            let commentEditForm = $('[data-edit-form-comment-id=' + commentId + ']');
            let commentVoting = $('[data-commentVoting-comment-id=' + commentId + ']');
            let showReplyTextArea = $('[data-show-reply-textarea-comment-id=' + commentId + ']');
            let ellipsis = $('#ellipsis_' + commentId);

            commentEditForm.addClass('hidden'); // hide the edit form
            commentBody.removeClass('hidden').html(comment.body); // show the new updated comment in the html
            commentVoting.removeClass('hidden');
            showReplyTextArea.removeClass('hidden');
            ellipsis.removeClass('hidden');
            hoverEllipsis();
        })
    });

    <!-- =================================================================================================================-->
    <!-- ============================================== DELETE Comment  ==================================================-->
    <!-- =================================================================================================================-->

    container.on("click", ".dropdown-delete-btn", function (e) {
        // use event delegation that targets an elements parent, something, that isn't dynamic: .container
        e.preventDefault(); // prevent default form behavior and instead use ajax.
        let commentInformation = $(this).parent().serialize();
        let button = $(this);
        // Look for element with this attribute. We're looking for siblings(other comments) within the container.
        let commentId = button.siblings('[data-comment-id]').data('comment-id');

        let request = $.ajax({
            url: '/posts/comment/' + commentId + '/delete',
            method: 'POST',
            data: commentInformation
            // data: JSON.stringify({id: deleteCommentId}),
        });
        request.done(function () {
            $('[data-edit-delete-comment-id=' + commentId + ']').fadeOut("slow", function () {
                $('[data-edit-delete-comment-id=' + commentId + ']').remove(); // new way targets element directly.
            });

            // $('[data-comment-vote-reply-options-id=' + commentId + ']').remove();
            // $('[data-comment-body-comment-id=' + commentId + ']').html('[deleted]');

            // $button.parent().parent().parent().parent().parent().remove(); // removes from html (old way/bad way)
        });
        request.fail((a, b, c) => {
            console.log(a, b, c)
        });
    });


    <!-- =================================================================================================================-->
    <!-- ============================================== POST VOTING  =====================================================-->
    <!-- =================================================================================================================-->

    postWrapper.on("click", ".postUpvote", function (e) {

        if ($(e.target).hasClass('stayActive')) {
            //remove vote
            let button = $(this);
            let postId = button.parent().data('upvote-post-id');
            let postFormUp = $('[data-upvote-post-id=' + postId + ']');

            let request = $.ajax({
                url: '/posts/' + postId + '/removeVote',
                method: 'POST',
                //dataType: 'json',
                data: postFormUp.serialize()
            });
            request.done(function (post) {

                $('.postVoteCount').html(post.voteCount);
                $('#post-info-vote-count').html(post.voteCount);
                $('.postUpvote').removeClass("stayActive");
            })
        } else {
            //upvote
            let button = $(this);
            let postId = button.parent().data('upvote-post-id');
            let postFormUp = $('[data-upvote-post-id=' + postId + ']');

            let request = $.ajax({
                url: postFormUp.attr('action'), //-> postVoting() in PostsController
                method: 'POST',
                data: postFormUp.serialize(),
            });
            request.done(function (post) {

                $('.postVoteCount').html(post.voteCount);
                $('#post-info-vote-count').html(post.voteCount);
                $('.postDownvote').removeClass("stayActiveDown");
                $('.postUpvote').addClass("stayActive");
            });

            request.fail((a, b, c) => {
                console.log(a, b, c)
            });
        }
    });

    postWrapper.on("click", ".postDownvote", function (e) {

        if ($(e.target).hasClass('stayActiveDown')) {
            //remove vote
            let button = $(this);
            let postId = button.parent().data('downvote-post-id');
            let postFormDown = $('[data-downvote-post-id=' + postId + ']');

            let request = $.ajax({
                url: '/posts/' + postId + '/removeVote', // -> voteRemoval() in PostsController
                method: 'POST',
                data: postFormDown.serialize()
            });
            request.done(function (post) {

                $('.postVoteCount').html(post.voteCount);
                $('#post-info-vote-count').html(post.voteCount);
                $('.postDownvote').removeClass("stayActiveDown");
            })
        } else {
            //downvote
            let button = $(this);
            let postId = button.parent().data('downvote-post-id');
            let postFormDown = $('[data-downvote-post-id=' + postId + ']');

            let request = $.ajax({
                url: postFormDown.attr('action'), // -> postVoting() in PostsController
                method: 'POST',
                //dataType: 'json', // returning an object by default
                data: postFormDown.serialize()
            });
            request.done(function (post) {

                $('.postVoteCount').html(post.voteCount);
                $('#post-info-vote-count').html(post.voteCount);
                $('.postUpvote').removeClass("stayActive");
                $('.postDownvote').addClass("stayActiveDown");
            });

            request.fail((a, b, c) => {
                console.log(a, b, c)
            });
        }
    });

    <!-- =================================================================================================================-->
    <!-- ============================================== COMMENT VOTING  ==================================================-->
    <!-- =================================================================================================================-->

    container.on("click", ".commentUpvote", function (e) {
        e.preventDefault();

        if ($(e.target).hasClass('stayActive')) {
            //remove vote
            let button = $(this);
            let commentId = button.parent().data('upvote-comment-id');
            let commentFormUp = $('[data-upvote-comment-id=' + commentId + ']');

            let request = $.ajax({
                url: '/comment/' + commentId + '/removeVote',
                method: 'POST',
                dataType: 'json',
                data: commentFormUp.serialize()
            });
            request.done(function (comment) {

                let commentUpIcon = $('[data-upvoteIcon-comment-id=' + commentId + ']');
                let commentVoteCount = $('[data-voteCount-comment-id=' + commentId + ']');

                commentVoteCount.html(comment.voteCount);
                commentUpIcon.removeClass("stayActive");
            })
        } else {
            //upvote
            let button = $(this);
            let commentId = button.parent().data('upvote-comment-id');
            let commentFormUp = $('[data-upvote-comment-id=' + commentId + ']');

            let request = $.ajax({
                url: commentFormUp.attr('action'), //-> commentVoting() in PostsController using the action path in the form element
                method: 'POST',
                data: commentFormUp.serialize()
            });
            request.done(function (comment) {

                let commentUpIcon = $('[data-upvoteIcon-comment-id=' + commentId + ']');
                let commentDownIcon = $('[data-downvoteIcon-comment-id=' + commentId + ']');
                let commentVoteCount = $('[data-voteCount-comment-id=' + commentId + ']');

                commentVoteCount.html(comment.voteCount);
                commentDownIcon.removeClass("stayActiveDown");
                commentUpIcon.addClass("stayActive");
            })
        }
    });

    container.on("click", ".commentDownvote", function (e) {
        e.preventDefault();

        if ($(e.target).hasClass('stayActiveDown')) {
            //remove vote
            let button = $(this);
            let commentId = button.parent().data('downvote-comment-id');
            let commentFormUp = $('[data-downvote-comment-id=' + commentId + ']');

            let request = $.ajax({
                url: '/comment/' + commentId + '/removeVote',
                method: 'POST',
                dataType: 'json',
                data: commentFormUp.serialize()
            });
            request.done(function (comment) {

                let commentDownIcon = $('[data-downvoteIcon-comment-id=' + commentId + ']');
                let commentVoteCount = $('[data-voteCount-comment-id=' + commentId + ']');

                commentVoteCount.html(comment.voteCount);
                commentDownIcon.removeClass("stayActiveDown");
            })
        } else {
            //downvote
            let button = $(this);
            let commentId = button.parent().data('downvote-comment-id');
            let commentFormDown = $('[data-downvote-comment-id=' + commentId + ']');

            let request = $.ajax({
                url: commentFormDown.attr('action'),
                method: 'POST',
                data: commentFormDown.serialize()
            });
            request.done(function (comment) {

                let commentUpIcon = $('[data-upvoteIcon-comment-id=' + commentId + ']');
                let commentDownIcon = $('[data-downvoteIcon-comment-id=' + commentId + ']');
                let commentVoteCount = $('[data-voteCount-comment-id=' + commentId + ']');

                commentVoteCount.html(comment.voteCount);
                commentUpIcon.removeClass("stayActive");
                commentDownIcon.addClass("stayActiveDown");
            })
        }
    });

    <!-- =================================================================================================================-->
    <!-- ============================================== REPLY TO COMMENTS  ===============================================-->
    <!-- =================================================================================================================-->

    container.on("click", ".commentReplyBtn", function (e) {
        e.preventDefault();

        let button = $(this);
        let commentId = button.data('reply-submit-btn-comment-id');
        let replyForm = $('[data-reply-form-comment-id=' + commentId + ']');

        $('#replyTextArea_' + commentId).addClass('hidden');

        let request = $.ajax({
            url: replyForm.attr('action'),
            method: 'POST',
            data: replyForm.serialize()
        });
        request.done((html) => {

            let replyWrapper = $('[data-wrapper-reply-textarea-comment-id=' + commentId + ']');
            let replyError = $('[data-reply-error-comment-id=' + commentId + ']');
            let replyForm = $('[data-reply-form-comment-id=' + commentId + ']');
            let replyFormBody = $('[data-reply-form-body-comment-id=' + commentId + ']');
            let showReplyTextArea = $('[data-show-reply-textarea-comment-id=' + commentId + ']');
            let cancelReply = $('[data-cancel-reply-textarea-comment-id=' + commentId + ']');
            let commentEditForm = $('[data-edit-form-comment-id=' + commentId + ']');
            let childCommentDiv = $('[data-child-node-comment-id=' + commentId + ']');

            // if statement here to check if html is that error fragment. (html could be both error or comment)
            if (!(html.includes("commentBodyText"))) { // if html is an error,
                // $('.repliesErrorAJAX').html(html).hide().fadeIn() // error belongs in the error div.
                replyError.html(html); // error belongs in the error div.

                showReplyTextArea.addClass('hidden');
                cancelReply.removeClass('hidden');
                replyWrapper.removeClass('hidden');
                replyForm.removeClass('hidden');
                replyFormBody.removeClass('hidden');
                console.log("the response was an error. error validation in place.")
            }

            if (html.includes("commentBodyText")) { // if html is a comment...
                if (replyError.length >= 1) { // check if error exists first
                    replyError.addClass('hidden'); // if error exists, hide it.
                    replyFormBody.val('');
                    showReplyTextArea.removeClass('hidden');
                    commentEditForm.addClass('hidden'); //hide the edit form.
                    replyWrapper.addClass('hidden'); // hide the reply text area.
                    console.log("response was a comment.");
                    cancelReply.addClass('hidden');
                }
                childCommentDiv.append(html).hide().fadeIn(1500); //append the comment in the childCommentDiv

                //scroll to reply when commented
                $('html, body').animate({
                    scrollTop: childCommentDiv.offset().top - $(window).height() / 2
                }, 100);
            }
            replyFormBody.val('');
        });

        request.fail((a, b, c) => {
            console.log(a, b, c)
        });

    })

// <!-- ==================================================================================================================-->
// <!-- ============================================== FLAG COMMENT ======================================================-->
// <!-- ==================================================================================================================-->


    container.on("click", ".dropdown-report-btn", function(e) {
        console.log("clicked report button");
        e.stopPropagation(); //keeps the dropdown menu open on click.
        e.preventDefault();

        let button = $(this);
        let commentId = button.data('flag-comment-id');
        let flagForm = $('[data-flag-comment-form-id=' + commentId + ']');
        console.log(commentId);

        let request = $.ajax({
            url: '/comment/' + commentId + '/flag',
            method: 'POST',
            data: flagForm.serialize()
            // data: commentId
        });
        request.done((commentFlag) => {
            console.log("back from flag method");
            button.html('<i class="fas fa-check"></i> reported');
        });
    })

</script>
</body>
</html>


<!--<div class="childCommentDiv" style="margin-left: 2em;" th:attr="data-child-node-comment-id=${comment.id}"></div>-->
