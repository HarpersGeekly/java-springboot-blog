<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="fragments/header :: my-header('Posts')">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
<nav th:include="fragments/navbar :: my-navbar"></nav>
<div class="indexCategoriesListWrapper">
    <a class="indexEachCategory" th:each="category : ${categories}" th:text="${category.name}" th:href="@{/posts/search(term=${category.name})}"></a>
</div>

    <div id="indexPageWrapper">

        <!--<h2 id="postIntro">recent harps of the day...</h2>-->

        <div class="content" th:each="post : ${page}">

            <div class="postWrapper">
                <div class="postPicWrapper">
                    <!--<span th:if="${post.user.profilePicture} == null">-->
                        <!--<img class="profilePicPostIndex" src="/../images/user.png"/>-->
                    <!--</span>-->
                    <!--<span th:if="${post.user.profilePicture} != null">-->
                        <!--<img class="profilePicPostIndex" th:src="@{'/uploads/' + ${post.user.profilePicture}}"/>-->
                    <!--</span>-->
                </div>

                <div class="postInfoWrapper">
                    <ul>
                        <li>
                            <h4 th:text="${post.title}" class="postTitleIndexPage">
                                <!--<a th:href="@{/posts/{id}(id=${post.id})}"</a> -->
                            </h4>

                            <i class="fas fa-thumbs-up postUpVoteIconIndex"></i>
                            <h5 class="postVoteCountIndex" th:text="${post.voteCount()}"></h5>
                            <i class="fas fa-comments postCommentIconIndex"></i>
                            <h5 class="postCommentSizeIndex" th:text="${post.getComments().size()}"></h5>
                            <div class="post-tags">
                                <a class="post-tag" th:each="tag : ${post.getCategories()}" th:text="${tag.name}" th:href="@{/posts/search(term=${tag.name})}"></a>
                            </div>
                            <h5><a class="postedByNameTextIndex" th:href="@{/profile/{id}(id=${post.user.id})}">
                                <span th:text="${post.user.username}"></span></a>
                                <span class="postedByDateTime" th:text="${#temporals.format(post.date,  'h:mm a')}"></span>
                                <span class="postedByDate" th:text="${#temporals.monthNameShort(post.date)}"></span>
                                <span class="postedByDate" th:text="${#temporals.day(post.date)}"></span>
                                <span class="postedByDate" th:text="${#temporals.year(post.date)}"></span>
                            </h5>

                            <div class="gradientBox">
                                <div class="postDescription">
                                    <p th:utext="${post.htmlDescription}"></p>
                                    <!--<div th:each="image : ${post.postImages}">-->
                                        <!--<img th:src="${image.path}"/>-->
                                    <!--</div>-->
                                </div>

                                <p>
                                    <i class="fas fa-hand-point-right fa-read-more"></i>
                                    <a class="read-more" th:href="@{/posts/{id}(id=${post.id})}">continue reading...</a>
                                </p>
                            </div>
                                <!--<h5 id="createdDate">created: <span th:text="${#temporals.format(post.date, 'MM-dd-yyyy, h:mm a')}"></span></h5>-->
                        </li>
                        <!--// wanna use a button to send to edit here? -->
                            <!--<button> <a th:href="@{/posts/{id}/edit(id=${post.id})}"  th:text="${'Edit: ' + post.title}"></a></button>-->
                    </ul>
                </div>
        <!--<hr class="commentHR"/>-->
        </div>
        </div>

    </div>

<footer th:include="fragments/footer :: my-footer"></footer>
<script>
    // $( document ).ready(function() {
    $('.postDescription img').each(function () {

        let maxWidth = 700;
        let ratio = 0;
        let img = $(this);

        if (img.width() > maxWidth) {
            ratio = img.height() / img.width();
            img.css("height", (maxWidth * ratio));
            img.css("width", maxWidth);
            // img.attr("height", (maxWidth * ratio));
            // img.attr("width", maxWidth);
        }
    });
    // });


//        var showChar = 100;
//        var ellipsestext = "...";
////        var moretext = "more";
////        var lesstext = "less";
//        $('.gradientBox').each(function() {
//            var content = $(this).html();
//
//            if(content.length > showChar) {
//
//                var c = content.substr(0, showChar);
//                var h = content.substr(showChar-1, content.length - showChar);
//
//                var html = c + '<span class="moreellipses">' + ellipsestext+ '&nbsp;</span>' +
//                    '<span>' + h +
//                    '</span>';
//
//                $(this).html(html);
//            }
//
//        });

//        $(".read-more").click(function(){
//            if($(this).hasClass("less")) {
//                $(this).removeClass("less");
//                $(this).html(moretext);
//            } else {
//                $(this).addClass("less");
//                $(this).html(lesstext);
//            }
//            $(this).parent().prev().toggle();
//            $(this).prev().toggle();
//            return false;
//        });



</script>
</body>
</html>