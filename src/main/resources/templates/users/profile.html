<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:include="fragments/header :: my-header('Profile')">
</head>
<body>
<nav th:include="fragments/navbar :: my-navbar"></nav>

<!-- Show different words or features based on whether you're on your profile or someone else's -->

<div class="container" id="profileWrap">
<!--============================================ VIEWING LOGGED IN USERS PROFILE ========================================-->
<!--Reminder: #authentication.principal is the currently logged-in/session user-->

    <th:block sec:authorize="isAuthenticated()" th:if="${isOwnProfile}">

        <h2>Welcome, <span th:text="${#authentication.principal.username}"></span>!</h2>

        <!--I'm very confused about image uploading.-->
        <!--Should I be saving profile pictures to the database?-->
            <!--Yes. Or use filestack...which is limiting-->

        <!--What should the column look like, a path, or filename?-->

        <!--What is the path at "Users/RyanHarper/tmp/uploads" mean? Will this be for every user?-->
                <!--No. It's just a path, and certainly shouldn't be a path on IntelliJ
                because it would never be reached.
                When deployed, the path will be changed to be housed on the server. So every user can have a picture -->

        <!--Why can't the page display my image on the page?-->

        <div class="profile-picture-wrapper">
            <span th:if="${#authentication.principal.profilePicture} == null">
                <img class="profilePic" src="/../images/user.png" width="150px" height="150px"/>
            </span>
            <span th:if="${#authentication.principal.profilePicture} != null">
                <img class="profilePic" th:src="@{'/uploads/' + ${#authentication.principal.profilePicture}}" width="150px" height="150px"/>
            </span>
        </div>

        <h3>You are logged in. You can make comments and <a id="profileCreatePostLink" th:href="${'/posts/create'}">create a post.</a></h3>

        <h4>
            <i class="far fa-envelope profileEmailIcon"></i>
                <span th:text="${#authentication.principal.email}"/>
        </h4>

        <h4>
            <i class="far fa-handshake profileJoinIcon"></i>
            <span th:text="${#temporals.monthNameShort(#authentication.principal.date)}"></span>
            <span th:text="${#temporals.day(#authentication.principal.date)}"></span>,
            <span th:text="${#temporals.year(#authentication.principal.date)}"></span>
        </h4>

        <div class="profileChangeUsernameDiv">
            <i class="fas fa-cog profileCogIcon"></i>
            <a th:href="@{/profile/{id}/edit(id=${#authentication.principal.id})}">
                <h5 id="profileChangeUsernameLink">edit account</h5>
            </a>
        </div>
        <div class="profileChangePasswordDiv">
            <i class="fas fa-lock-open profilePasswordIcon"></i>
            <a th:href="@{/profile/{id}/editPassword(id=${#authentication.principal.id})}">
                <h5 id="profileChangePasswordLink">change your password</h5>
            </a>
        </div>

    <hr class="commentHR"/>

        <h4>Your posts:</h4>
        <h5 th:if="${postsAreEmpty}">
            <i class="far fa-frown profileFrownIcon"></i> You don't have any posts yet... get posting!
        </h5>
    </th:block>

<!--============================================== VIEWING OTHER USERS PROFILES ===========================================-->

    <th:block th:if="${!isOwnProfile}">
        <h2><span th:text="${profileUser.username}"></span>'s profile!</h2>

        <span th:if="${profileUser.profilePicture} == null">
                <img class="profilePic" src="/../images/user.png" width="150px" height="150px"/>
            </span>
        <span th:if="${profileUser.profilePicture} != null">
                <img class="profilePic" th:src="@{'/uploads/' + ${profileUser.profilePicture}}" width="150px" height="150px"/>
            </span>

        <h4>
            <i class="far fa-envelope profileEmailIcon"></i>
                <span th:text="${profileUser.email}"></span>
        </h4>
        <h4>
            <i class="far fa-handshake profileJoinIcon"></i>
                <span th:text="${#temporals.monthNameShort(profileUser.date)}"></span>
                <span th:text="${#temporals.day(profileUser.date)}"></span>,
                <span th:text="${#temporals.year(profileUser.date)}"></span>
        </h4>

    <hr class="commentHR"/>

        <h4>Their posts:</h4>
        <h5 th:if="${postsAreEmpty}">
            <i class="far fa-frown profileFrownIcon"></i> They don't have any posts yet... lame!
        </h5>
    </th:block>

<!--============================================== THE LIST OF POSTS ======================================================-->

    <div id="profileContent" th:each="post : ${profileUser.posts}">
        <ul>
            <li>
                <div class="profilePostVoteTitleRow">

                    <div class="profilePostVoteCountDiv">
                        <h5 class="profilePostVoteCountText" th:text="${post.voteCount()}"></h5>
                    </div>

                    <div class="profilePostThumbsUpDiv">
                        <i class="fas fa-thumbs-up profilePostVoteIcon"></i>
                    </div>

                    <div class="profilePostCommentCountDiv">
                        <h5 class="profilePostCommentCountText" th:text="${post.getComments().size()}"></h5>
                    </div>

                    <div class="profilePostCommentIconDiv">
                        <i class="fas fa-comments profilePostCommentIcon"></i>
                    </div>

                    <div class="profilePostTitleDiv">
                        <a th:href="@{/posts/{id}(id=${post.id})}"><h4 class="profilePostTitleText" th:text="${post.title}"></h4></a>
                    </div>

                </div>
                <!--=====markdown parsing:===============-->
                <h5 th:utext="${post.htmlDescription}"></h5>
                <!--=====================================-->
                <h5 id="createdDate"><strong>created on:
                    <span th:text="${#temporals.monthNameShort(post.date)}"></span>
                    <span th:text="${#temporals.day(post.date)}"></span>,
                    <span th:text="${#temporals.year(post.date)}"></span> at
                    <span th:text="${#temporals.format(post.date,  'h:mm a')}"></span></strong></h5>

                <div th:if="${isOwnProfile}">
                    <div class="container">

                        <div class="row">
                            <div class="col-sm">
                                <a class="btn btn-primary" id="profileEditPostBtn" th:href="${'/posts/' + post.id + '/edit'}">
                                    <i class="far fa-edit"></i> Edit
                                </a>

                            <!--=================================== DELETE BUTTON =========================================-->
                                <form th:action="@{'/posts/' + ${post.id} + '/delete'}" method="post"> <!--th:object="${post}"-->
                                    <!--<input type="hidden" name="id" th:field="*{id}" />-->
                                    <button type="submit" class="btn btn-primary btn-danger" id="profileDeletePostBtn">
                                        <i class="fas fa-bomb"></i> Delete
                                    </button>
                                    <!-- <input th:if="${isEditable}"-->
                                </form>
                            </div>
                        </div>

                    </div>
                </div>

            </li>
        </ul>
    </div>

</div>
<footer th:include="fragments/footer :: my-footer"></footer>
</body>
</html>